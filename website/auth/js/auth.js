async function handleLogin(e) { e.preventDefault(); hideError(); hideSuccess(); const btn = document.getElementById('login-btn'); btn.textContent = 'LOGGING IN...'; btn.disabled = true; const username = document.getElementById('login-username').value; const password = document.getElementById('login-password').value; try { const response = await fetch(`${API_URL}/auth/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) }); const data = await response.json(); if (response.ok) { localStorage.setItem('token', data.token); localStorage.setItem('user', JSON.stringify(data.user)); localStorage.setItem('loginTime', Date.now().toString()); if (data.user.role === 'admin') { window.location.href = 'admin-dash.html'; } else { window.location.href = 'dash.html'; } } else { showError(data.error || 'Login failed'); btn.textContent = 'LOGIN'; btn.disabled = false; } } catch (error) { console.error('Login error:', error); showError('Network error. Please check your connection.'); btn.textContent = 'LOGIN'; btn.disabled = false; } } async function handleRegister(e) { e.preventDefault(); hideError(); hideSuccess(); const btn = document.getElementById('register-btn'); btn.textContent = 'CREATING ACCOUNT...'; btn.disabled = true; const username = document.getElementById('register-username').value; const email = document.getElementById('register-email').value; const password = document.getElementById('register-password').value; try { const response = await fetch(`${API_URL}/auth/register`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, email, password }) }); const data = await response.json(); if (response.ok) { localStorage.setItem('token', data.token); localStorage.setItem('user', JSON.stringify(data.user)); localStorage.setItem('loginTime', Date.now().toString()); window.location.href = 'dashboard.html'; } else { showError(data.error || 'Registration failed'); btn.textContent = 'CREATE ACCOUNT'; btn.disabled = false; } } catch (error) { console.error('Registration error:', error); showError('Network error. Please check your connection.'); btn.textContent = 'CREATE ACCOUNT'; btn.disabled = false; } }
