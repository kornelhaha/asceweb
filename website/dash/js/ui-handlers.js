let throwPotState={weaponSlot:1,potionSlots:[false,true,true,false,false,false,false,false,false]};function checkLicenseStatus(){hasActiveLicense=currentUser.license&&currentUser.license.status==='active';updateLicenseRestrictions()}function updateLicenseRestrictions(){const navItems=document.querySelectorAll('.nav-item[data-requires-license="true"]');navItems.forEach(item=>{if(hasActiveLicense){item.classList.remove('locked')}else{item.classList.add('locked')}});const modulesContent=document.getElementById('modulesContent');const noLicenseMessage=document.getElementById('noLicenseMessage');if(hasActiveLicense){modulesContent.style.display='block';noLicenseMessage.style.display='none'}else{modulesContent.style.display='none';noLicenseMessage.style.display='block'}const downloadContent=document.getElementById('downloadContent');const noLicenseMessageDownload=document.getElementById('noLicenseMessageDownload');if(hasActiveLicense){downloadContent.style.display='block';noLicenseMessageDownload.style.display='none'}else{downloadContent.style.display='none';noLicenseMessageDownload.style.display='block'}}function updateUserDisplay(){const userNameEl=document.getElementById('userName');const userAvatarEl=document.getElementById('userAvatar');const userLicenseEl=document.getElementById('userLicense');if(userNameEl)userNameEl.textContent=currentUser.username||'User';if(userAvatarEl)userAvatarEl.textContent=(currentUser.username||'U').charAt(0).toUpperCase();if(userLicenseEl){if(currentUser.license){const timeRemaining=currentUser.license.timeRemaining||'Lifetime';userLicenseEl.textContent=`${currentUser.license.type} â€¢ ${timeRemaining}`;userLicenseEl.classList.add('premium')}else{userLicenseEl.textContent='No License';userLicenseEl.classList.remove('premium')}}document.getElementById('settingsUsername').textContent=currentUser.username;document.getElementById('settingsEmail').textContent=currentUser.email;document.getElementById('settingsRole').textContent=currentUser.role;document.getElementById('settingsClicks').textContent=(currentUser.totalClicks||0).toLocaleString();updateLicenseDisplay()}function updateLicenseDisplay(){const licenseBadge=document.getElementById('licenseBadge');const licenseExpiry=document.getElementById('licenseExpiry');const licenseExpiryRow=document.getElementById('licenseExpiryRow');const activationSection=document.getElementById('activationSection');if(currentUser.license){licenseBadge.textContent=currentUser.license.type.charAt(0).toUpperCase()+currentUser.license.type.slice(1);licenseBadge.className='license-badge '+currentUser.license.type;licenseExpiryRow.style.display='flex';licenseExpiry.textContent=currentUser.license.timeRemaining;activationSection.style.display='none'}else{licenseBadge.textContent='No License';licenseBadge.className='license-badge expired';licenseExpiryRow.style.display='none';activationSection.style.display='block'}}function calculateCpsRange(baseCps){const variance=baseCps*0.125;const minCps=Math.max(1,baseCps-variance).toFixed(1);const maxCps=Math.min(25,baseCps+variance).toFixed(1);return`(${minCps}-${maxCps})`}function applySettings(config){console.log('[APPLY] Applying settings:',config);const leftClickerToggle=document.querySelector('.module-toggle-leftclicker');if(leftClickerToggle&&config.enabled!==undefined){if(config.enabled){leftClickerToggle.classList.add('active')}else{leftClickerToggle.classList.remove('active')}}if(config.cps!==undefined){const cps=parseFloat(config.cps);const cpsValue=document.getElementById('leftclicker-cpsValue');const cpsSlider=document.getElementById('leftclicker-cpsSlider');const cpsRange=document.getElementById('leftclicker-cpsRange');if(cpsValue)cpsValue.textContent=cps.toFixed(1);if(cpsSlider)cpsSlider.value=cps;if(cpsRange)cpsRange.textContent=calculateCpsRange(cps)}if(config.hotkeyCode!==undefined){const hotkeyInput=document.getElementById('leftclicker-hotkeyInput');if(hotkeyInput)hotkeyInput.value=getKeyName(config.hotkeyCode)}const holdToClick=document.querySelector('.checkbox-leftclicker-hold');if(holdToClick&&config.holdToClick!==undefined){if(config.holdToClick){holdToClick.classList.add('checked')}else{holdToClick.classList.remove('checked')}}const blatantMode=document.querySelector('.checkbox-leftclicker-blatant');if(blatantMode&&config.blatantMode!==undefined){if(config.blatantMode){blatantMode.classList.add('checked')}else{blatantMode.classList.remove('checked')}}const exhaustToggle=document.querySelector('.mini-toggle-leftclicker-exhaust');if(exhaustToggle&&config.exhaustMode!==undefined){if(config.exhaustMode){exhaustToggle.classList.add('active')}else{exhaustToggle.classList.remove('active')}}if(config.exhaustDropCps!==undefined){const drop=parseFloat(config.exhaustDropCps);const dropValue=document.getElementById('leftclicker-exhaustDropValue');const dropSlider=document.getElementById('leftclicker-exhaustDropSlider');if(dropValue)dropValue.textContent=drop.toFixed(1);if(dropSlider)dropSlider.value=drop}if(config.exhaustChance!==undefined){const chance=parseInt(config.exhaustChance);const chanceValue=document.getElementById('leftclicker-exhaustChanceValue');const chanceSlider=document.getElementById('leftclicker-exhaustChanceSlider');if(chanceValue)chanceValue.textContent=chance+'%';if(chanceSlider)chanceSlider.value=chance}const spikeToggle=document.querySelector('.mini-toggle-leftclicker-spike');if(spikeToggle&&config.spikeMode!==undefined){if(config.spikeMode){spikeToggle.classList.add('active')}else{spikeToggle.classList.remove('active')}}if(config.spikeIncreaseCps!==undefined){const increase=parseFloat(config.spikeIncreaseCps);const increaseValue=document.getElementById('leftclicker-spikeIncreaseValue');const increaseSlider=document.getElementById('leftclicker-spikeIncreaseSlider');if(increaseValue)increaseValue.textContent=increase.toFixed(1);if(increaseSlider)increaseSlider.value=increase}if(config.spikeChance!==undefined){const chance=parseInt(config.spikeChance);const chanceValue=document.getElementById('leftclicker-spikeChanceValue');const chanceSlider=document.getElementById('leftclicker-spikeChanceSlider');if(chanceValue)chanceValue.textContent=chance+'%';if(chanceSlider)chanceSlider.value=chance}const randomToggle=document.querySelector('.mini-toggle-leftclicker-randomization');if(randomToggle&&config.enableRandomization!==undefined){if(config.enableRandomization){randomToggle.classList.add('active')}else{randomToggle.classList.remove('active')}}if(config.randomizationAmount!==undefined){const amount=parseFloat(config.randomizationAmount);const amountValue=document.getElementById('leftclicker-randomizationAmountValue');const amountSlider=document.getElementById('leftclicker-randomizationAmountSlider');if(amountValue)amountValue.textContent=amount.toFixed(1);if(amountSlider)amountSlider.value=amount}const blockhitToggle=document.querySelector('.module-toggle-blockhit');if(blockhitToggle&&config.blockhitEnabled!==undefined){if(config.blockhitEnabled){blockhitToggle.classList.add('active')}else{blockhitToggle.classList.remove('active')}}if(config.blockChance!==undefined){const chance=parseInt(config.blockChance);const chanceValue=document.getElementById('blockhit-blockChanceValue');const chanceSlider=document.getElementById('blockhit-blockChanceSlider');if(chanceValue)chanceValue.textContent=chance+'%';if(chanceSlider)chanceSlider.value=chance}if(config.holdLengthMin!==undefined){const holdMin=parseInt(config.holdLengthMin);const minValue=document.getElementById('blockhit-holdMinValue');const minSlider=document.getElementById('blockhit-holdMinSlider');if(minValue)minValue.textContent=holdMin;if(minSlider)minSlider.value=holdMin}if(config.holdLengthMax!==undefined){const holdMax=parseInt(config.holdLengthMax);const maxValue=document.getElementById('blockhit-holdMaxValue');const maxSlider=document.getElementById('blockhit-holdMaxSlider');if(maxValue)maxValue.textContent=holdMax;if(maxSlider)maxSlider.value=holdMax}if(config.delayMin!==undefined){const delayMin=parseInt(config.delayMin);const minValue=document.getElementById('blockhit-delayMinValue');const minSlider=document.getElementById('blockhit-delayMinSlider');if(minValue)minValue.textContent=delayMin;if(minSlider)minSlider.value=delayMin}if(config.delayMax!==undefined){const delayMax=parseInt(config.delayMax);const maxValue=document.getElementById('blockhit-delayMaxValue');const maxSlider=document.getElementById('blockhit-delayMaxSlider');if(maxValue)maxValue.textContent=delayMax;if(maxSlider)maxSlider.value=delayMax}const onlyWhileClicking=document.querySelector('.checkbox-blockhit-onlyclick');if(onlyWhileClicking&&config.onlyWhileClicking!==undefined){if(config.onlyWhileClicking){onlyWhileClicking.classList.add('checked')}else{onlyWhileClicking.classList.remove('checked')}}const hideLoader=document.querySelector('.checkbox-loadersettings-hide');if(hideLoader&&config.hideLoader!==undefined){if(config.hideLoader){hideLoader.classList.add('checked')}else{hideLoader.classList.remove('checked')}}const throwPotToggle=document.querySelector('.module-toggle-throwpot');if(throwPotToggle&&config.throwPotEnabled!==undefined){if(config.throwPotEnabled){throwPotToggle.classList.add('active')}else{throwPotToggle.classList.remove('active')}}if(config.throwPotHotkey!==undefined){const hotkeyInput=document.getElementById('throwpot-hotkeyInput');if(hotkeyInput)hotkeyInput.value=getKeyName(config.throwPotHotkey)}if(config.throwPotWeaponSlot!==undefined){const slot=parseInt(config.throwPotWeaponSlot);throwPotState.weaponSlot=slot;document.querySelectorAll('.slot-checkbox-throwpot-weapon').forEach(el=>el.classList.remove('selected'));const slotEl=document.querySelector(`.slot-checkbox-throwpot-weapon[data-slot="${slot}"]`);if(slotEl)slotEl.classList.add('selected')}if(config.throwPotSlots!==undefined){const slotsStr=config.throwPotSlots;for(let i=0;i<9&&i<slotsStr.length;i++){throwPotState.potionSlots[i]=(slotsStr[i]==='1');const checkbox=document.querySelector(`.checkbox-throwpot-potion-${i+1}`);if(checkbox){if(throwPotState.potionSlots[i]){checkbox.classList.add('checked')}else{checkbox.classList.remove('checked')}}}}if(config.throwPotSlotDelay!==undefined){const delay=parseInt(config.throwPotSlotDelay);const delayValue=document.getElementById('throwpot-slotSwitchDelayValue');const delaySlider=document.getElementById('throwpot-slotSwitchDelaySlider');if(delayValue)delayValue.textContent=delay;if(delaySlider)delaySlider.value=delay}if(config.throwPotThrowDelay!==undefined){const delay=parseInt(config.throwPotThrowDelay);const delayValue=document.getElementById('throwpot-throwDelayValue');const delaySlider=document.getElementById('throwpot-throwDelaySlider');if(delayValue)delayValue.textContent=delay;if(delaySlider)delaySlider.value=delay}if(config.throwPotReturnDelay!==undefined){const delay=parseInt(config.throwPotReturnDelay);const delayValue=document.getElementById('throwpot-returnDelayValue');const delaySlider=document.getElementById('throwpot-returnDelaySlider');if(delayValue)delayValue.textContent=delay;if(delaySlider)delaySlider.value=delay}}function filterCategory(category){document.querySelectorAll('.category-tab').forEach(tab=>tab.classList.remove('active'));event.currentTarget.classList.add('active');document.querySelectorAll('.module-card').forEach(card=>{if(card.dataset.category===category){card.classList.add('visible')}else{card.classList.remove('visible')}})}function updateCps(value){if(isUpdatingFromServer)return;const cpsValue=parseFloat(value);document.getElementById('leftclicker-cpsValue').textContent=cpsValue.toFixed(1);document.getElementById('leftclicker-cpsRange').textContent=calculateCpsRange(cpsValue);saveSettings({cps:cpsValue})}function updateExhaustDrop(value){if(isUpdatingFromServer)return;document.getElementById('leftclicker-exhaustDropValue').textContent=parseFloat(value).toFixed(1);saveSettings({exhaustDropCps:parseFloat(value)})}function updateExhaustChance(value){if(isUpdatingFromServer)return;document.getElementById('leftclicker-exhaustChanceValue').textContent=parseInt(value)+'%';saveSettings({exhaustChance:parseInt(value)})}function updateSpikeIncrease(value){if(isUpdatingFromServer)return;document.getElementById('leftclicker-spikeIncreaseValue').textContent=parseFloat(value).toFixed(1);saveSettings({spikeIncreaseCps:parseFloat(value)})}function updateSpikeChance(value){if(isUpdatingFromServer)return;document.getElementById('leftclicker-spikeChanceValue').textContent=parseInt(value)+'%';saveSettings({spikeChance:parseInt(value)})}function updateRandomizationAmount(value){if(isUpdatingFromServer)return;document.getElementById('leftclicker-randomizationAmountValue').textContent=parseFloat(value).toFixed(1);saveSettings({randomizationAmount:parseFloat(value)})}function updateBlockChance(value){if(isUpdatingFromServer)return;document.getElementById('blockhit-blockChanceValue').textContent=parseInt(value)+'%';saveSettings({blockChance:parseInt(value)})}function updateHoldMin(value){if(isUpdatingFromServer)return;const holdValue=parseInt(value);document.getElementById('blockhit-holdMinValue').textContent=holdValue;const maxSlider=document.getElementById('blockhit-holdMaxSlider');if(holdValue>parseInt(maxSlider.value)){maxSlider.value=holdValue;document.getElementById('blockhit-holdMaxValue').textContent=holdValue;saveSettings({holdLengthMin:holdValue,holdLengthMax:holdValue})}else{saveSettings({holdLengthMin:holdValue})}}function updateHoldMax(value){if(isUpdatingFromServer)return;const holdValue=parseInt(value);document.getElementById('blockhit-holdMaxValue').textContent=holdValue;const minSlider=document.getElementById('blockhit-holdMinSlider');if(holdValue<parseInt(minSlider.value)){minSlider.value=holdValue;document.getElementById('blockhit-holdMinValue').textContent=holdValue;saveSettings({holdLengthMin:holdValue,holdLengthMax:holdValue})}else{saveSettings({holdLengthMax:holdValue})}}function updateDelayMin(value){if(isUpdatingFromServer)return;const delayValue=parseInt(value);document.getElementById('blockhit-delayMinValue').textContent=delayValue;const maxSlider=document.getElementById('blockhit-delayMaxSlider');if(delayValue>parseInt(maxSlider.value)){maxSlider.value=delayValue;document.getElementById('blockhit-delayMaxValue').textContent=delayValue;saveSettings({delayMin:delayValue,delayMax:delayValue})}else{saveSettings({delayMin:delayValue})}}function updateDelayMax(value){if(isUpdatingFromServer)return;const delayValue=parseInt(value);document.getElementById('blockhit-delayMaxValue').textContent=delayValue;const minSlider=document.getElementById('blockhit-delayMinSlider');if(delayValue<parseInt(minSlider.value)){minSlider.value=delayValue;document.getElementById('blockhit-delayMinValue').textContent=delayValue;saveSettings({delayMin:delayValue,delayMax:delayValue})}else{saveSettings({delayMax:delayValue})}}function updateSlotSwitchDelay(value){if(isUpdatingFromServer)return;document.getElementById('throwpot-slotSwitchDelayValue').textContent=parseInt(value);saveSettings({throwPotSlotDelay:parseInt(value)})}function updateThrowDelay(value){if(isUpdatingFromServer)return;document.getElementById('throwpot-throwDelayValue').textContent=parseInt(value);saveSettings({throwPotThrowDelay:parseInt(value)})}function updateReturnDelay(value){if(isUpdatingFromServer)return;document.getElementById('throwpot-returnDelayValue').textContent=parseInt(value);saveSettings({throwPotReturnDelay:parseInt(value)})}function selectWeaponSlot(slot){if(isUpdatingFromServer)return;document.querySelectorAll('.slot-checkbox-throwpot-weapon').forEach(el=>{el.classList.remove('selected')});const slotEl=document.querySelector(`.slot-checkbox-throwpot-weapon[data-slot="${slot}"]`);if(slotEl){slotEl.classList.add('selected')}throwPotState.weaponSlot=slot;saveSettings({throwPotWeaponSlot:slot})}function togglePotionSlot(slot){if(isUpdatingFromServer)return;const index=slot-1;throwPotState.potionSlots[index]=!throwPotState.potionSlots[index];const checkbox=document.querySelector(`.checkbox-throwpot-potion-${slot}`);if(checkbox){if(throwPotState.potionSlots[index]){checkbox.classList.add('checked')}else{checkbox.classList.remove('checked')}}const slotsString=throwPotState.potionSlots.map(s=>s?'1':'0').join('');saveSettings({throwPotSlots:slotsString})}function toggleModule(moduleName){if(isUpdatingFromServer)return;const toggle=document.querySelector(`.module-toggle-${moduleName}`);if(!toggle)return;toggle.classList.toggle('active');const isActive=toggle.classList.contains('active');if(moduleName==='leftclicker'){saveSettings({enabled:isActive})}else if(moduleName==='blockhit'){saveSettings({blockhitEnabled:isActive})}else if(moduleName==='throwpot'){saveSettings({throwPotEnabled:isActive})}}function toggleModuleSettings(moduleName){const settings=document.getElementById(`${moduleName}-settings`);const btn=document.querySelector(`.expand-btn-${moduleName}`);if(settings&&btn){const isOpen=settings.classList.contains('show');if(isOpen){btn.classList.remove('expanded');settings.classList.remove('show')}else{btn.classList.add('expanded');settings.classList.add('show')}}}function toggleMiniSetting(element,settingName){if(isUpdatingFromServer)return;element.classList.toggle('active');saveSettings({[settingName]:element.classList.contains('active')})}function toggleCheckbox(element,settingName){if(isUpdatingFromServer)return;element.classList.toggle('checked');saveSettings({[settingName]:element.classList.contains('checked')})}function recordKeybind(input,moduleName){if(!input)return;input.classList.add('recording');input.value='Press any key...';const handler=(e)=>{e.preventDefault();input.value=getKeyName(e.keyCode);input.classList.remove('recording');if(moduleName==='throwpot'){saveSettings({throwPotHotkey:e.keyCode})}else{saveSettings({hotkeyCode:e.keyCode})}document.removeEventListener('keydown',handler)};document.addEventListener('keydown',handler)}function getKeyName(keyCode){const keyMap={112:'F1',113:'F2',114:'F3',115:'F4',116:'F5',117:'F6',118:'F7',119:'F8',120:'F9',121:'F10',122:'F11',123:'F12',16:'SHIFT',17:'CTRL',18:'ALT',20:'CAPS',32:'SPACE',13:'ENTER',8:'BACKSPACE',9:'TAB',82:'R'};return keyMap[keyCode]||String.fromCharCode(keyCode).toUpperCase()}function switchSection(event,section){if(!event)return;event.preventDefault();const navItem=event.currentTarget;if(navItem&&navItem.classList.contains('locked')){alert('This section requires an active license.');section='settings'}document.querySelectorAll('.nav-item').forEach(nav=>nav.classList.remove('active'));const targetNav=document.querySelector(`.nav-item[data-section="${section}"]`);if(targetNav)targetNav.classList.add('active');document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));const sectionEl=document.getElementById(section+'-section');if(sectionEl)sectionEl.classList.add('active');const titles={'modules':{text:'Modules',icon:'fa-th-large'},'settings':{text:'Settings',icon:'fa-cog'},'download':{text:'Download',icon:'fa-download'}};if(titles[section]){document.getElementById('pageTitle').textContent=titles[section].text;document.getElementById('pageTitleIcon').className='fas '+titles[section].icon}}function switchSettingsTab(tabName){document.querySelectorAll('.settings-tab').forEach(tab=>tab.classList.remove('active'));document.querySelectorAll('.settings-tab-content').forEach(content=>content.classList.remove('active'));event.currentTarget.classList.add('active');const tabContent=document.getElementById(`${tabName}-tab`);if(tabContent)tabContent.classList.add('active')}
