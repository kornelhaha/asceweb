<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>asce. - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ==================== BREATHTAKING CANVAS BACKGROUND ==================== */
        #canvas-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #000;
        }

        .dashboard-layout {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        .sidebar {
            width: 240px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-family: 'Space Mono', monospace;
            font-size: 1.8em;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .logo i {
            color: #fff;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 12px;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #666;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-bottom: 4px;
            font-size: 0.9em;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: #fff;
            color: #000;
            font-weight: 600;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .nav-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-item.locked:hover {
            background: transparent;
            color: #666;
            transform: none;
        }

        .nav-item i {
            font-size: 1.1em;
            width: 20px;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 8px;
            color: #ff4444;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            font-size: 0.85em;
            width: 100%;
            font-family: 'Inter', sans-serif;
        }

        .logout-btn:hover {
            background: rgba(255, 68, 68, 0.2);
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.3);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #000;
            font-family: 'Space Mono', monospace;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9em;
        }

        .user-license {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.7);
        }

        .user-license.premium {
            color: #fff;
        }

        .main-content {
            flex: 1;
            margin-left: 240px;
            padding: 0;
            background: transparent;
        }

        .top-bar {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .page-title {
            font-size: 1.8em;
            font-family: 'Space Mono', monospace;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* Connection status in top right */
        .connection-status-topbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.85em;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .connection-status-topbar:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #f00;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
        }

        .status-dot.connected {
            background: #0f0;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 25px rgba(0, 255, 0, 1);
                transform: scale(1.2);
            }
        }

        .content-area {
            padding: 32px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }

        .category-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .category-tab:hover::before {
            left: 100%;
        }

        .category-tab:hover {
            border-color: #fff;
            color: #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .category-tab.active {
            background: #fff;
            border-color: #fff;
            color: #000;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 16px;
        }  

        /* Module Card Styles with Glassmorphism */
        .leftclicker-card,
        .macro-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            position: relative;
            overflow: hidden;
        }

        .leftclicker-card::before,
        .macro-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .leftclicker-card:hover::before,
        .macro-card:hover::before {
            opacity: 1;
        }

        .leftclicker-card.leftclicker-visible {
            display: block;
            animation: cardSlideIn 0.5s ease;
        }

        .macro-card.macro-visible {
            display: block;
            animation: cardSlideIn 0.5s ease;
        }

        @keyframes cardSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .leftclicker-card:hover,
        .macro-card:hover {
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }

        .leftclicker-header,
        .macro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .leftclicker-title,
        .macro-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.05em;
        }

        .leftclicker-icon,
        .macro-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .leftclicker-toggle,
        .macro-toggle {
            position: relative;
            width: 48px;
            height: 26px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .leftclicker-toggle.leftclicker-active,
        .macro-toggle.macro-active {
            background: #fff;
            border-color: #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .leftclicker-toggle-slider,
        .macro-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .leftclicker-toggle.leftclicker-active .leftclicker-toggle-slider,
        .macro-toggle.macro-active .macro-toggle-slider {
            transform: translateX(22px);
            background: #000;
        }

        .leftclicker-settings,
        .macro-settings {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leftclicker-settings.leftclicker-show,
        .macro-settings.macro-show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }

        .leftclicker-setting-row,
        .macro-setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .leftclicker-setting-label,
        .macro-setting-label {
            font-size: 0.9em;
            color: #ccc;
        }

        .leftclicker-setting-value,
        .macro-setting-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: #fff;
            font-weight: 600;
        }

        .leftclicker-slider-container {
            width: 100%;
            margin-top: 8px;
        }

        .leftclicker-slider {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .leftclicker-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            transition: all 0.2s ease;
        }

        .leftclicker-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
        }

        .leftclicker-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .leftclicker-expand-btn,
        .macro-expand-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .leftclicker-expand-btn:hover,
        .macro-expand-btn:hover {
            color: #fff;
            transform: scale(1.1);
        }

        .leftclicker-expand-btn i,
        .macro-expand-btn i {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .leftclicker-expand-btn.leftclicker-expanded i,
        .macro-expand-btn.macro-expanded i {
            transform: rotate(180deg);
        }

        .leftclicker-keybind-input,
        .macro-keybind-input {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #fff;
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .leftclicker-keybind-input:hover,
        .macro-keybind-input:hover {
            border-color: #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .leftclicker-keybind-input.leftclicker-recording {
            border-color: #0f0;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            animation: recording-pulse 1s infinite;
        }

        @keyframes recording-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .leftclicker-checkbox {
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .leftclicker-checkbox i {
            display: none;
        }

        .leftclicker-checkbox.leftclicker-checked {
            background: #fff;
            border-color: #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .leftclicker-checkbox.leftclicker-checked i {
            color: #000;
            display: block;
        }

        .macro-keybind-input {
            width: 100%;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .license-required-message {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .license-required-message i {
            font-size: 3em;
            margin-bottom: 16px;
            color: #ffffff;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5));
        }

        .license-required-message h3 {
            font-size: 1.5em;
            margin-bottom: 12px;
            color: #fff;
        }

        .license-required-message p {
            margin-bottom: 24px;
        }

        .license-required-message .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #fff;
            border: none;
            border-radius: 6px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            text-decoration: none;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .license-required-message .btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.5);
        }

        /* ==================== SETTINGS STYLES ==================== */
        
        .settings-container {
            max-width: 1200px;
        }

        .settings-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 0;
        }

        .settings-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 500;
            margin-bottom: -2px;
        }

        .settings-tab:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .settings-tab.active {
            color: #fff;
            border-bottom-color: #fff;
            background: transparent;
        }

        .settings-tab i {
            font-size: 1.1em;
        }

        .settings-tab-content {
            display: none;
        }

        .settings-tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
        }

        .settings-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .settings-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.05);
        }

        .settings-card-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }

        .settings-card-title i {
            color: #666;
            font-size: 1em;
        }

        .danger-card {
            border-color: rgba(255, 68, 68, 0.3);
        }

        .danger-card:hover {
            border-color: rgba(255, 68, 68, 0.5);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85em;
            color: #999;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #fff;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #fff;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn {
            padding: 10px 20px;
            background: #fff;
            border: none;
            border-radius: 6px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .info-box:last-child {
            margin-bottom: 0;
        }

        .info-box.warning {
            border-color: rgba(255, 136, 0, 0.3);
            background: rgba(255, 136, 0, 0.05);
        }

        .info-box.success {
            border-color: rgba(0, 255, 0, 0.3);
            background: rgba(0, 255, 0, 0.05);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .info-row:first-child {
            padding-top: 0;
        }

        .info-label {
            color: #666;
            font-size: 0.85em;
        }

        .info-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: #fff;
            font-weight: 500;
        }

        .success-message,
        .error-message {
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            display: none;
            font-size: 0.85em;
            align-items: center;
            gap: 8px;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            color: #0f0;
        }

        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: #ff4444;
        }

        .success-message.show,
        .error-message.show {
            display: flex;
        }

        .license-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
        }

        .license-badge.lifetime,
        .license-badge.month,
        .license-badge.week {
            background: #ffffff;
            color: #000000;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .license-badge.expired {
            background: rgba(255, 255, 255, 0.1);
            color: #666;
        }

        @media (max-width: 900px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Breathtaking Canvas Background -->
    <canvas id="canvas-background"></canvas>

    <div class="dashboard-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                    <span>asce.</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item active" data-section="modules" data-requires-license="true" onclick="switchSection(event, 'modules')">
                    <i class="fas fa-th-large"></i>
                    <span>Modules</span>
                </div>
                <div class="nav-item" data-section="settings" onclick="switchSection(event, 'settings')">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="nav-item" data-section="download" data-requires-license="true" onclick="switchSection(event, 'download')">
                    <i class="fas fa-download"></i>
                    <span>Download</span>
                </div>
                <div class="nav-item" data-section="changelog" onclick="switchSection(event, 'changelog')">
                    <i class="fas fa-list"></i>
                    <span>Changelog</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>

                <div class="user-profile" onclick="switchSection(event, 'settings')">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-license" id="userLicense"></div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: #666; font-size: 0.8em;"></i>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <div class="page-title">
                    <i id="pageTitleIcon" class="fas fa-th-large"></i>
                    <span id="pageTitle">Modules</span>
                </div>

                <div class="connection-status-topbar">
                    <div class="status-dot" id="connectionDot"></div>
                    <span id="connectionText">not connected</span>
                </div>
            </div>

            <div class="content-area">
                <div id="modules-section" class="content-section active">
                    <div id="modulesContent">
                        <div class="category-tabs">
                            <div class="category-tab active" data-category="combat" onclick="filterCategory(event, 'combat')">COMBAT</div>
                            <div class="category-tab" data-category="utilities" onclick="filterCategory(event, 'utilities')">UTILITIES</div>
                        </div>

                        <div class="module-grid" id="moduleGrid">
                            <!-- Left Clicker -->
                            <div class="leftclicker-card leftclicker-visible" data-category="combat" data-module="leftclicker" data-name="left clicker">
                                <div class="leftclicker-header">
                                    <div class="leftclicker-title">
                                        <div class="leftclicker-icon"><i class="fas fa-mouse-pointer"></i></div>
                                        <span>Left Clicker</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <button class="leftclicker-expand-btn" onclick="toggleLeftClickerSettings()">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="leftclicker-toggle" data-setting="enabled" onclick="toggleLeftClicker()">
                                            <div class="leftclicker-toggle-slider"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="leftclicker-settings" id="module-leftclicker-settings">
                                    <div class="leftclicker-setting-row">
                                        <span class="leftclicker-setting-label">CPS</span>
                                        <span class="leftclicker-setting-value" id="leftclickerCpsValue">10.0</span>
                                    </div>
                                    <div class="leftclicker-slider-container">
                                        <input type="range" class="leftclicker-slider" min="1" max="25" step="0.1" value="10" oninput="updateLeftClickerCps(this.value)" id="leftclickerCpsSlider">
                                    </div>
                                    <div class="leftclicker-setting-row" style="margin-top: 16px;">
                                        <span class="leftclicker-setting-label">Hotkey</span>
                                        <input type="text" class="leftclicker-keybind-input" value="F6" readonly onclick="recordLeftClickerKeybind(this)" id="leftclickerHotkeyInput">
                                    </div>
                                    <div class="leftclicker-setting-row" style="margin-top: 16px;">
                                        <span class="leftclicker-setting-label">Hold to Click</span>
                                        <div class="leftclicker-checkbox" data-setting="holdToClick" onclick="toggleLeftClickerHoldToClick()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="leftclicker-setting-row">
                                        <span class="leftclicker-setting-label">Blatant Mode</span>
                                        <div class="leftclicker-checkbox" data-setting="blatantMode" onclick="toggleLeftClickerBlatantMode()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="leftclicker-setting-row">
                                        <span class="leftclicker-setting-label">Exhaust Mode</span>
                                        <div class="leftclicker-checkbox" data-setting="exhaustMode" onclick="toggleLeftClickerExhaustMode()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Macro -->
                            <div class="macro-card" data-category="utilities" data-module="macro" data-name="macro">
                                <div class="macro-header">
                                    <div class="macro-title">
                                        <div class="macro-icon"><i class="fas fa-code"></i></div>
                                        <span>Macro</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <button class="macro-expand-btn" onclick="toggleMacroSettings()">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="macro-toggle" data-setting="useMacro" onclick="toggleMacro()">
                                            <div class="macro-toggle-slider"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="macro-settings" id="module-macro-settings">
                                    <div class="macro-setting-row">
                                        <span class="macro-setting-label">Loaded Intervals</span>
                                        <span class="macro-setting-value" id="macroIntervalCount">0</span>
                                    </div>
                                    <div style="margin-top: 16px;">
                                        <button class="macro-keybind-input" onclick="openMacroEditor()">
                                            <i class="fas fa-edit"></i> Edit Macro
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="noLicenseMessage" class="license-required-message" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>License Required</h3>
                        <p>You need an active license to access modules.</p>
                        <a href="#" class="btn" onclick="switchSection(event, 'settings'); return false;">
                            <i class="fas fa-key"></i> Activate License
                        </a>
                    </div>
                </div>

                <div id="settings-section" class="content-section">
                    <div class="settings-container">
                        <div class="settings-tabs">
                            <div class="settings-tab active" onclick="switchSettingsTab('account')">
                                <i class="fas fa-user"></i>
                                <span>Account</span>
                            </div>
                            <div class="settings-tab" onclick="switchSettingsTab('license')">
                                <i class="fas fa-certificate"></i>
                                <span>License</span>
                            </div>
                            <div class="settings-tab" onclick="switchSettingsTab('security')">
                                <i class="fas fa-lock"></i>
                                <span>Security</span>
                            </div>
                        </div>

                        <div id="account-tab" class="settings-tab-content active">
                            <div class="settings-grid">
                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-info-circle"></i>
                                        Account Information
                                    </div>
                                    <div class="info-box">
                                        <div class="info-row">
                                            <span class="info-label">Username</span>
                                            <span class="info-value" id="settingsUsername">-</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Email</span>
                                            <span class="info-value" id="settingsEmail">-</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Role</span>
                                            <span class="info-value" id="settingsRole">-</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Total Clicks</span>
                                            <span class="info-value" id="settingsClicks">-</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-envelope"></i>
                                        Change Email
                                    </div>
                                    <div class="success-message" id="emailSuccess">
                                        <i class="fas fa-check-circle"></i> Email updated!
                                    </div>
                                    <div class="error-message" id="emailError">
                                        <i class="fas fa-exclamation-circle"></i> <span id="emailErrorText"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New Email Address</label>
                                        <input type="email" class="form-input" id="newEmailInput" placeholder="your@email.com">
                                    </div>
                                    <button class="btn btn-full" onclick="changeEmail()">
                                        <i class="fas fa-save"></i> Update Email
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="license-tab" class="settings-tab-content">
                            <div class="settings-grid">
                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-certificate"></i>
                                        Current License
                                    </div>
                                    <div class="info-box" id="licenseInfoBox">
                                        <div class="info-row">
                                            <span class="info-label">Type</span>
                                            <span class="info-value">
                                                <span class="license-badge" id="licenseBadge">Free</span>
                                            </span>
                                        </div>
                                        <div class="info-row" id="licenseExpiryRow" style="display: none;">
                                            <span class="info-label">Expires In</span>
                                            <span class="info-value" id="licenseExpiry">-</span>
                                        </div>
                                        <div class="info-row" id="licenseStatusRow" style="display: none;">
                                            <span class="info-label">Status</span>
                                            <span class="info-value" id="licenseStatus">Active</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-card" id="activationSection">
                                    <div class="settings-card-title">
                                        <i class="fas fa-key"></i>
                                        Activate License
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">License Key</label>
                                        <input type="text" class="form-input" id="licenseKeyInput" placeholder="XXXXX-XXXXX-XXXXX-XXXXX">
                                    </div>
                                    <button class="btn btn-full" onclick="activateLicense()">
                                        <i class="fas fa-check"></i> Activate Now
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="security-tab" class="settings-tab-content">
                            <div class="settings-grid">
                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-lock"></i>
                                        Change Password
                                    </div>
                                    <div class="success-message" id="passwordSuccess">
                                        <i class="fas fa-check-circle"></i> Password updated!
                                    </div>
                                    <div class="error-message" id="passwordError">
                                        <i class="fas fa-exclamation-circle"></i> <span id="passwordErrorText"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Current Password</label>
                                        <input type="password" class="form-input" id="currentPasswordInput" placeholder="••••••••">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New Password</label>
                                        <input type="password" class="form-input" id="newPasswordInput" placeholder="••••••••">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-input" id="confirmPasswordInput" placeholder="••••••••">
                                    </div>
                                    <button class="btn btn-full" onclick="changePassword()">
                                        <i class="fas fa-save"></i> Update Password
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="download-section" class="content-section">
                    <div id="downloadContent">
                        <div class="settings-container">
                            <div class="settings-card" style="max-width: 600px; margin: 0 auto;">
                                <div class="settings-card-title">
                                    <i class="fas fa-download"></i>
                                    Download asce. Client
                                </div>
                                
                                <div class="info-box" style="margin-bottom: 20px;">
                                    <p style="margin-bottom: 12px; color: #ccc;">Choose a custom filename or use a randomized name for added security.</p>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Filename</label>
                                    <input type="text" class="form-input" id="customFilename" placeholder="asce" value="asce">
                                </div>

                                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                                    <button class="btn" style="flex: 1;" onclick="downloadClient(false)">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn" style="flex: 1; background: rgba(255,255,255,0.1); color: #fff;" onclick="downloadClient(true)">
                                        <i class="fas fa-random"></i> Random Name
                                    </button>
                                </div>

                                <div class="info-box warning">
                                    <div style="display: flex; align-items: start; gap: 12px;">
                                        <i class="fas fa-info-circle" style="color: #ff8800; margin-top: 2px;"></i>
                                        <div style="font-size: 0.85em; color: #ccc;">
                                            <p style="margin-bottom: 8px;"><strong>Important:</strong></p>
                                            <ul style="margin-left: 20px; line-height: 1.6;">
                                                <li>Windows Defender may flag the client as a false positive</li>
                                                <li>Add an exclusion for the client in Windows Security</li>
                                                <li>Keep your login credentials secure</li>
                                                <li>One PC per account (HWID locked)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div id="downloadStatus" class="success-message" style="margin-top: 16px;">
                                    <i class="fas fa-check-circle"></i> <span id="downloadStatusText"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="noLicenseMessageDownload" class="license-required-message" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>License Required</h3>
                        <p>You need an active license to download the client.</p>
                        <a href="#" class="btn" onclick="switchSection(event, 'settings'); return false;">
                            <i class="fas fa-key"></i> Activate License
                        </a>
                    </div>
                </div>

                <div id="changelog-section" class="content-section">
                    <div class="empty-state">
                        <i class="fas fa-list"></i>
                        <p>Changelog coming soon</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==================== BREATHTAKING CANVAS BACKGROUND ====================
        const canvas = document.getElementById('canvas-background');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Particle system for dynamic network effect
        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.radius = Math.random() * 2 + 1;
                this.alpha = Math.random() * 0.5 + 0.2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
                ctx.fill();
            }
        }

        // Create particles
        const particles = [];
        const particleCount = 100;
        for (let i = 0; i < particleCount; i++) {
            particles.push(new Particle());
        }

        // Mouse interaction
        let mouse = { x: null, y: null, radius: 150 };
        canvas.addEventListener('mousemove', (e) => {
            mouse.x = e.x;
            mouse.y = e.y;
        });

        canvas.addEventListener('mouseleave', () => {
            mouse.x = null;
            mouse.y = null;
        });

        // Animation loop
        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update and draw particles
            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });

            // Draw connections between particles
            particles.forEach((p1, i) => {
                particles.slice(i + 1).forEach(p2 => {
                    const dx = p1.x - p2.x;
                    const dy = p1.y - p2.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < 120) {
                        ctx.beginPath();
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.15 * (1 - distance / 120)})`;
                        ctx.lineWidth = 0.5;
                        ctx.stroke();
                    }
                });

                // Mouse interaction - attract particles
                if (mouse.x !== null && mouse.y !== null) {
                    const dx = p1.x - mouse.x;
                    const dy = p1.y - mouse.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < mouse.radius) {
                        ctx.beginPath();
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(mouse.x, mouse.y);
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.3 * (1 - distance / mouse.radius)})`;
                        ctx.lineWidth = 1;
                        ctx.stroke();

                        // Add glow effect
                        const gradient = ctx.createRadialGradient(mouse.x, mouse.y, 0, mouse.x, mouse.y, mouse.radius);
                        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
                        gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                        ctx.fillStyle = gradient;
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                }
            });

            requestAnimationFrame(animate);
        }

        animate();

        // ==================== DASHBOARD LOGIC ====================
        let lastSavedConfig = {};
        let saveTimeout = null;
        let clientConnected = false;

        const API_URL = 'https://asce-0hoi.onrender.com/api';
        let currentConfig = {};
        let currentUser = {};
        let ws = null;
        let isUpdatingFromServer = false;
        let hasActiveLicense = false;

        function isSessionValid() {
            const token = localStorage.getItem('token');
            const loginTime = localStorage.getItem('loginTime');
    
            if (!token || !loginTime) {
                return false;
            }

            const now = Date.now();
            const elapsed = now - parseInt(loginTime);
            const oneHour = 60 * 60 * 1000;

            if (elapsed > oneHour) {
                return false;
            }

            return true;
        }

        async function init() {
            if (!isSessionValid()) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                localStorage.removeItem('loginTime');
                window.location.href = 'auth.html';
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'auth.html';
                return;
            }

            try {
                await loadUserProfile();
                await loadSettings();
                connectWebSocket(token);
            } catch (error) {
                console.error('Init error:', error);
            }
        }

        async function loadUserProfile() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_URL}/user/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    currentUser = await response.json();
                    updateUserDisplay();
                    checkLicenseStatus();
                }
            } catch (error) {}
        }

        function checkLicenseStatus() {
            if (currentUser.license && currentUser.license.status === 'active') {
                hasActiveLicense = true;
            } else {
                hasActiveLicense = false;
            }
            updateLicenseRestrictions();
        }

        function updateLicenseRestrictions() {
            const navItems = document.querySelectorAll('.nav-item[data-requires-license="true"]');
            navItems.forEach(item => {
                if (hasActiveLicense) {
                    item.classList.remove('locked');
                } else {
                    item.classList.add('locked');
                }
            });

            const modulesContent = document.getElementById('modulesContent');
            const noLicenseMessage = document.getElementById('noLicenseMessage');
            if (modulesContent && noLicenseMessage) {
                if (hasActiveLicense) {
                    modulesContent.style.display = 'block';
                    noLicenseMessage.style.display = 'none';
                } else {
                    modulesContent.style.display = 'none';
                    noLicenseMessage.style.display = 'block';
                }
            }

            const downloadContent = document.getElementById('downloadContent');
            const noLicenseMessageDownload = document.getElementById('noLicenseMessageDownload');
            if (downloadContent && noLicenseMessageDownload) {
                if (hasActiveLicense) {
                    downloadContent.style.display = 'block';
                    noLicenseMessageDownload.style.display = 'none';
                } else {
                    downloadContent.style.display = 'none';
                    noLicenseMessageDownload.style.display = 'block';
                }
            }
        }

        function updateUserDisplay() {
            const userNameEl = document.getElementById('userName');
            const userAvatarEl = document.getElementById('userAvatar');
            const userLicenseEl = document.getElementById('userLicense');
            
            if (userNameEl) userNameEl.textContent = currentUser.username || 'User';
            if (userAvatarEl) userAvatarEl.textContent = (currentUser.username || 'U').charAt(0).toUpperCase();
            
            if (userLicenseEl) {
                if (currentUser.license) {
                    const timeRemaining = currentUser.license.timeRemaining || 'Lifetime';
                    userLicenseEl.textContent = `${currentUser.license.type} • ${timeRemaining}`;
                    userLicenseEl.classList.add('premium');
                } else {
                    userLicenseEl.textContent = 'No License';
                    userLicenseEl.classList.remove('premium');
                }
            }

            const settingsUsername = document.getElementById('settingsUsername');
            const settingsEmail = document.getElementById('settingsEmail');
            const settingsRole = document.getElementById('settingsRole');
            const settingsClicks = document.getElementById('settingsClicks');

            if (settingsUsername) settingsUsername.textContent = currentUser.username;
            if (settingsEmail) settingsEmail.textContent = currentUser.email;
            if (settingsRole) settingsRole.textContent = currentUser.role;
            if (settingsClicks) settingsClicks.textContent = (currentUser.totalClicks || 0).toLocaleString();

            updateLicenseDisplay();
        }

        function updateLicenseDisplay() {
            const licenseBadge = document.getElementById('licenseBadge');
            const licenseExpiry = document.getElementById('licenseExpiry');
            const licenseStatus = document.getElementById('licenseStatus');
            const licenseExpiryRow = document.getElementById('licenseExpiryRow');
            const licenseStatusRow = document.getElementById('licenseStatusRow');
            const activationSection = document.getElementById('activationSection');
            const licenseInfoBox = document.getElementById('licenseInfoBox');

            if (currentUser.license) {
                const license = currentUser.license;
                if (licenseBadge) {
                    licenseBadge.textContent = license.type.charAt(0).toUpperCase() + license.type.slice(1);
                    licenseBadge.className = 'license-badge ' + license.type;
                }
                if (licenseExpiryRow) licenseExpiryRow.style.display = 'flex';
                if (licenseExpiry) licenseExpiry.textContent = license.timeRemaining;
                if (licenseStatusRow) licenseStatusRow.style.display = 'flex';
                if (licenseStatus) licenseStatus.textContent = license.status.charAt(0).toUpperCase() + license.status.slice(1);
                if (activationSection) activationSection.style.display = 'none';
                if (licenseInfoBox) licenseInfoBox.className = 'info-box success';
            } else {
                if (licenseBadge) {
                    licenseBadge.textContent = 'No License';
                    licenseBadge.className = 'license-badge expired';
                }
                if (licenseExpiryRow) licenseExpiryRow.style.display = 'none';
                if (licenseStatusRow) licenseStatusRow.style.display = 'none';
                if (activationSection) activationSection.style.display = 'block';
                if (licenseInfoBox) licenseInfoBox.className = 'info-box warning';
            }
        }

        async function activateLicense() {
            const token = localStorage.getItem('token');
            const licenseKeyInput = document.getElementById('licenseKeyInput');
            if (!licenseKeyInput || !licenseKeyInput.value.trim()) {
                alert('Please enter a license key');
                return;
            }
            try {
                const response = await fetch(`${API_URL}/auth/activate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ licenseKey: licenseKeyInput.value.trim() })
                });
                const data = await response.json();
                if (response.ok) {
                    alert('License activated successfully!');
                    licenseKeyInput.value = '';
                    await loadUserProfile();
                } else {
                    alert(data.error || 'Failed to activate license');
                }
            } catch (error) {
                alert('Failed to activate license');
            }
        }

        async function changeEmail() {
            const token = localStorage.getItem('token');
            const newEmailInput = document.getElementById('newEmailInput');
            const emailSuccess = document.getElementById('emailSuccess');
            const emailError = document.getElementById('emailError');
            const emailErrorText = document.getElementById('emailErrorText');
            if (emailSuccess) emailSuccess.classList.remove('show');
            if (emailError) emailError.classList.remove('show');
            if (!newEmailInput || !newEmailInput.value.trim()) {
                if (emailErrorText) emailErrorText.textContent = 'Please enter a new email';
                if (emailError) emailError.classList.add('show');
                return;
            }
            try {
                const response = await fetch(`${API_URL}/user/profile`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: newEmailInput.value.trim() })
                });
                const data = await response.json();
                if (response.ok) {
                    if (emailSuccess) emailSuccess.classList.add('show');
                    newEmailInput.value = '';
                    await loadUserProfile();
                } else {
                    if (emailErrorText) emailErrorText.textContent = data.error || 'Failed to update email';
                    if (emailError) emailError.classList.add('show');
                }
            } catch (error) {
                if (emailErrorText) emailErrorText.textContent = 'Failed to update email';
                if (emailError) emailError.classList.add('show');
            }
        }

        async function changePassword() {
            const token = localStorage.getItem('token');
            const currentPasswordInput = document.getElementById('currentPasswordInput');
            const newPasswordInput = document.getElementById('newPasswordInput');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const passwordSuccess = document.getElementById('passwordSuccess');
            const passwordError = document.getElementById('passwordError');
            const passwordErrorText = document.getElementById('passwordErrorText');
            if (passwordSuccess) passwordSuccess.classList.remove('show');
            if (passwordError) passwordError.classList.remove('show');
            if (!currentPasswordInput || !currentPasswordInput.value) {
                if (passwordErrorText) passwordErrorText.textContent = 'Please enter your current password';
                if (passwordError) passwordError.classList.add('show');
                return;
            }
            if (!newPasswordInput || !newPasswordInput.value) {
                if (passwordErrorText) passwordErrorText.textContent = 'Please enter a new password';
                if (passwordError) passwordError.classList.add('show');
                return;
            }
            if (newPasswordInput.value !== confirmPasswordInput.value) {
                if (passwordErrorText) passwordErrorText.textContent = 'Passwords do not match';
                if (passwordError) passwordError.classList.add('show');
                return;
            }
            try {
                const response = await fetch(`${API_URL}/user/profile`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        currentPassword: currentPasswordInput.value,
                        newPassword: newPasswordInput.value
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    if (passwordSuccess) passwordSuccess.classList.add('show');
                    currentPasswordInput.value = '';
                    newPasswordInput.value = '';
                    confirmPasswordInput.value = '';
                } else {
                    if (passwordErrorText) passwordErrorText.textContent = data.error || 'Failed to update password';
                    if (passwordError) passwordError.classList.add('show');
                }
            } catch (error) {
                if (passwordErrorText) passwordErrorText.textContent = 'Failed to update password';
                if (passwordError) passwordError.classList.add('show');
            }
        }

        async function loadSettings() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_URL}/agent/settings`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    currentConfig = await response.json();
                    isUpdatingFromServer = true;
                    applySettings(currentConfig);
                    isUpdatingFromServer = false;
                }
            } catch (error) {}
        }

        function generateRandomName() {
            const adjectives = ['swift', 'shadow', 'silent', 'ghost', 'phantom', 'stealth', 'rapid', 'quick', 'flash', 'blaze'];
            const nouns = ['client', 'app', 'tool', 'utility', 'helper', 'agent', 'service', 'runner', 'launcher', 'handler'];
            const random = Math.floor(Math.random() * 10000);
            
            const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            
            return `${adj}_${noun}_${random}`;
        }

        async function downloadClient(useRandomName) {
            const token = localStorage.getItem('token');
            const statusEl = document.getElementById('downloadStatus');
            const statusText = document.getElementById('downloadStatusText');
            
            try {
                let filename;
                
                if (useRandomName) {
                    filename = generateRandomName();
                } else {
                    const customInput = document.getElementById('customFilename');
                    filename = customInput.value.trim() || 'asce';
                    filename = filename.replace(/\.exe$/i, '');
                }
                
                if (statusEl) {
                    statusText.textContent = `Preparing ${filename}.exe for download...`;
                    statusEl.classList.add('show');
                }
                
                const response = await fetch(`${API_URL}/download/client?filename=${encodeURIComponent(filename)}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Download failed');
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `${filename}.exe`;
                
                document.body.appendChild(a);
                a.click();
                
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                if (statusEl) {
                    statusText.textContent = `Successfully downloaded ${filename}.exe`;
                    setTimeout(() => {
                        statusEl.classList.remove('show');
                    }, 5000);
                }
                
            } catch (error) {
                console.error('Download error:', error);
                if (statusEl) {
                    statusEl.className = 'error-message show';
                    statusText.textContent = 'Download failed. Please try again.';
                    setTimeout(() => {
                        statusEl.classList.remove('show');
                        statusEl.className = 'success-message';
                    }, 5000);
                }
            }
        }

        function applySettings(config) {
            try {
                const leftClickerToggle = document.querySelector('.leftclicker-toggle[data-setting="enabled"]');
                if (leftClickerToggle) {
                    if (config.enabled) {
                        leftClickerToggle.classList.add('leftclicker-active');
                    } else {
                        leftClickerToggle.classList.remove('leftclicker-active');
                    }
                }

                const leftclickerCpsValue = document.getElementById('leftclickerCpsValue');
                const leftclickerCpsSlider = document.getElementById('leftclickerCpsSlider');
                if (leftclickerCpsValue) leftclickerCpsValue.textContent = (config.cps || 10).toFixed(1);
                if (leftclickerCpsSlider) leftclickerCpsSlider.value = config.cps || 10;

                const leftclickerHotkeyInput = document.getElementById('leftclickerHotkeyInput');
                if (leftclickerHotkeyInput && config.hotkeyCode) {
                    const keyName = getKeyName(config.hotkeyCode);
                    leftclickerHotkeyInput.value = keyName;
                }

                const holdToClickCheck = document.querySelector('.leftclicker-checkbox[data-setting="holdToClick"]');
                if (holdToClickCheck) {
                    if (config.holdToClick) {
                        holdToClickCheck.classList.add('leftclicker-checked');
                    } else {
                        holdToClickCheck.classList.remove('leftclicker-checked');
                    }
                }

                const blatantModeCheck = document.querySelector('.leftclicker-checkbox[data-setting="blatantMode"]');
                if (blatantModeCheck) {
                    if (config.blatantMode) {
                        blatantModeCheck.classList.add('leftclicker-checked');
                    } else {
                        blatantModeCheck.classList.remove('leftclicker-checked');
                    }
                }

                const exhaustModeCheck = document.querySelector('.leftclicker-checkbox[data-setting="exhaustMode"]');
                if (exhaustModeCheck) {
                    if (config.exhaustMode) {
                        exhaustModeCheck.classList.add('leftclicker-checked');
                    } else {
                        exhaustModeCheck.classList.remove('leftclicker-checked');
                    }
                }

                const macroToggle = document.querySelector('.macro-toggle[data-setting="useMacro"]');
                if (macroToggle) {
                    if (config.useMacro) {
                        macroToggle.classList.add('macro-active');
                    } else {
                        macroToggle.classList.remove('macro-active');
                    }
                }

                const macroIntervalCount = document.getElementById('macroIntervalCount');
                if (macroIntervalCount) {
                    macroIntervalCount.textContent = config.macroIntervals ? config.macroIntervals.length : 0;
                }

                lastSavedConfig = { ...config };
            } catch (error) {
                console.error('Apply settings error:', error);
            }
        }

        async function saveSettings(updates) {
            if (isUpdatingFromServer) return;
            
            const token = localStorage.getItem('token');
            currentConfig = { ...currentConfig, ...updates };

            let hasRealChanges = false;
            for (const key in updates) {
                if (lastSavedConfig[key] !== updates[key]) {
                    hasRealChanges = true;
                    break;
                }
            }

            if (!hasRealChanges) {
                return;
            }

            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`${API_URL}/agent/settings`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(currentConfig)
                    });

                    if (response.ok) {
                        lastSavedConfig = { ...currentConfig };
                    }
                } catch (error) {
                    console.error('Save settings error:', error);
                }
            }, 500);
        }

        function toggleLeftClickerSettings() {
            const settings = document.getElementById('module-leftclicker-settings');
            const btn = document.querySelector('.leftclicker-expand-btn');
            if (settings && btn) {
                const isOpen = settings.classList.contains('leftclicker-show');
                if (isOpen) {
                    btn.classList.remove('leftclicker-expanded');
                    settings.classList.remove('leftclicker-show');
                } else {
                    btn.classList.add('leftclicker-expanded');
                    settings.classList.add('leftclicker-show');
                }
            }
        }

        function toggleLeftClicker() {
            if (isUpdatingFromServer) return;
            const toggle = document.querySelector('.leftclicker-toggle[data-setting="enabled"]');
            if (!toggle) return;
            toggle.classList.toggle('leftclicker-active');
            const isActive = toggle.classList.contains('leftclicker-active');
            saveSettings({ enabled: isActive });
        }

        function updateLeftClickerCps(value) {
            if (isUpdatingFromServer) return;
            const valueEl = document.getElementById('leftclickerCpsValue');
            if (valueEl) valueEl.textContent = parseFloat(value).toFixed(1);
            saveSettings({ cps: parseFloat(value) });
        }

        function getKeyName(keyCode) {
            const keyMap = {
                112: 'F1', 113: 'F2', 114: 'F3', 115: 'F4', 116: 'F5', 117: 'F6',
                118: 'F7', 119: 'F8', 120: 'F9', 121: 'F10', 122: 'F11', 123: 'F12',
                16: 'SHIFT', 17: 'CTRL', 18: 'ALT', 20: 'CAPS',
                32: 'SPACE', 13: 'ENTER', 8: 'BACKSPACE', 9: 'TAB'
            };
            return keyMap[keyCode] || String.fromCharCode(keyCode).toUpperCase();
        }

        function recordLeftClickerKeybind(input) {
            if (!input) return;
            input.classList.add('leftclicker-recording');
            input.value = 'Press any key...';
            
            const handler = (e) => {
                e.preventDefault();
                const keyName = getKeyName(e.keyCode);
                input.value = keyName;
                input.classList.remove('leftclicker-recording');
                saveSettings({ hotkeyCode: e.keyCode });
                document.removeEventListener('keydown', handler);
            };
            
            document.addEventListener('keydown', handler);
        }

        function toggleLeftClickerHoldToClick() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.leftclicker-checkbox[data-setting="holdToClick"]');
            if (!checkbox) return;
            checkbox.classList.toggle('leftclicker-checked');
            const isChecked = checkbox.classList.contains('leftclicker-checked');
            saveSettings({ holdToClick: isChecked });
        }

        function toggleLeftClickerBlatantMode() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.leftclicker-checkbox[data-setting="blatantMode"]');
            if (!checkbox) return;
            checkbox.classList.toggle('leftclicker-checked');
            const isChecked = checkbox.classList.contains('leftclicker-checked');
            saveSettings({ blatantMode: isChecked });
        }

        function toggleLeftClickerExhaustMode() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.leftclicker-checkbox[data-setting="exhaustMode"]');
            if (!checkbox) return;
            checkbox.classList.toggle('leftclicker-checked');
            const isChecked = checkbox.classList.contains('leftclicker-checked');
            saveSettings({ exhaustMode: isChecked });
        }

        function toggleMacroSettings() {
            const settings = document.getElementById('module-macro-settings');
            const btn = document.querySelector('.macro-expand-btn');
            if (settings && btn) {
                const isOpen = settings.classList.contains('macro-show');
                if (isOpen) {
                    btn.classList.remove('macro-expanded');
                    settings.classList.remove('macro-show');
                } else {
                    btn.classList.add('macro-expanded');
                    settings.classList.add('macro-show');
                }
            }
        }

        function toggleMacro() {
            if (isUpdatingFromServer) return;
            const toggle = document.querySelector('.macro-toggle[data-setting="useMacro"]');
            if (!toggle) return;
            toggle.classList.toggle('macro-active');
            const isActive = toggle.classList.contains('macro-active');
            saveSettings({ useMacro: isActive });
        }

        function filterCategory(event, category) {
            if (!event) return;
            document.querySelectorAll('.category-tab').forEach(tab => {
                if (tab) tab.classList.remove('active');
            });
            if (event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            const leftClickerCards = document.querySelectorAll('.leftclicker-card');
            const macroCards = document.querySelectorAll('.macro-card');
            
            leftClickerCards.forEach(card => {
                if (!card) return;
                if (card.dataset.category === category) {
                    card.classList.add('leftclicker-visible');
                } else {
                    card.classList.remove('leftclicker-visible');
                }
            });
            
            macroCards.forEach(card => {
                if (!card) return;
                if (card.dataset.category === category) {
                    card.classList.add('macro-visible');
                } else {
                    card.classList.remove('macro-visible');
                }
            });
        }

        function switchSection(event, section) {
            if (!event) return;
            event.preventDefault();
            
            const navItem = event.currentTarget;
            if (navItem && navItem.classList.contains('locked')) {
                alert('This section requires an active license. Please activate a license in Settings.');
                section = 'settings';
            }
            
            document.querySelectorAll('.nav-item').forEach(nav => {
                if (nav) nav.classList.remove('active');
            });
            
            const targetNav = document.querySelector(`.nav-item[data-section="${section}"]`);
            if (targetNav) {
                targetNav.classList.add('active');
            }
            
            document.querySelectorAll('.content-section').forEach(s => {
                if (s) s.classList.remove('active');
            });
            const sectionEl = document.getElementById(section + '-section');
            if (sectionEl) {
                sectionEl.classList.add('active');
            }
            const titles = {
                'modules': { text: 'Modules', icon: 'fa-th-large' },
                'settings': { text: 'Settings', icon: 'fa-cog' },
                'download': { text: 'Download', icon: 'fa-download' },
                'changelog': { text: 'Changelog', icon: 'fa-list' }
            };
            if (titles[section]) {
                const pageTitle = document.getElementById('pageTitle');
                const pageTitleIcon = document.getElementById('pageTitleIcon');
                if (pageTitle) pageTitle.textContent = titles[section].text;
                if (pageTitleIcon) pageTitleIcon.className = 'fas ' + titles[section].icon;
            }
        }

        function switchSettingsTab(tabName) {
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.settings-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            
            const tabContent = document.getElementById(`${tabName}-tab`);
            if (tabContent) {
                tabContent.classList.add('active');
            }
        }

        function connectWebSocket(token) {
            try {
                ws = new WebSocket(`wss://asce-0hoi.onrender.com?token=${token}`);
                
                ws.onopen = () => {
                    console.log('[WS] WebSocket connected');
                };
                
                ws.onclose = () => {
                    console.log('[WS] WebSocket disconnected, reconnecting...');
                    setTimeout(() => connectWebSocket(token), 3000);
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        if (data.type === 'agent_heartbeat') {
                            clientConnected = true;
                            const dot = document.getElementById('connectionDot');
                            const text = document.getElementById('connectionText');
                            if (dot) dot.classList.add('connected');
                            if (text) text.textContent = 'connected';
                        }
                        
                        if (data.type === 'settings_updated') {
                            isUpdatingFromServer = true;
                            applySettings(data.settings);
                            isUpdatingFromServer = false;
                        }
                    } catch (error) {
                        console.error('[WS] Message parse error:', error);
                    }
                };
                
                ws.onerror = (error) => {
                    console.error('[WS] WebSocket error:', error);
                };
            } catch (error) {
                console.error('[WS] WebSocket connection error:', error);
            }
        }

        async function logout() {
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }

            const token = localStorage.getItem('token');
            try {
                await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
            } catch (error) {}
    
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            localStorage.removeItem('loginTime');
    
            window.location.href = 'auth.html';
        }

        function openMacroEditor() {
            alert('Macro editor coming soon!');
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
