<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>asce.</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }

        .dashboard-layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 240px;
            background: #000;
            border-right: 1px solid #1a1a1a;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #1a1a1a;
        }

        .logo {
            font-family: 'Space Mono', monospace;
            font-size: 1.8em;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            color: #fff;
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 12px;
            overflow-y: auto;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #666;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            font-size: 0.9em;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #1a1a1a;
            color: #fff;
        }

        .nav-item.active {
            background: #fff;
            color: #000;
            font-weight: 600;
        }

        .nav-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-item.locked:hover {
            background: transparent;
            color: #666;
        }

        .nav-item i {
            font-size: 1.1em;
            width: 20px;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid #1a1a1a;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #0d0d0d;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.85em;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #f00;
        }

        .status-dot.connected {
            background: #0f0;
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.6);
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            color: #ff4444;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
            font-size: 0.85em;
            width: 100%;
            font-family: 'Inter', sans-serif;
        }

        .logout-btn:hover {
            background: #2a2a2a;
            border-color: #ff4444;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #0d0d0d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-profile:hover {
            background: #1a1a1a;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #000;
            font-family: 'Space Mono', monospace;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9em;
        }

        .user-license {
            font-size: 0.75em;
            color: #ffffff;
        }

        .user-license.premium {
            color: #ffffff;
        }

        .main-content {
            flex: 1;
            margin-left: 240px;
            padding: 0;
        }

        .top-bar {
            background: #000;
            border-bottom: 1px solid #1a1a1a;
            padding: 20px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8em;
            font-family: 'Space Mono', monospace;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .search-bar {
            position: relative;
        }

        .search-bar input {
            padding: 10px 16px 10px 40px;
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            color: #fff;
            width: 300px;
            font-size: 0.9em;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #fff;
        }

        .search-bar i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .content-area {
            padding: 32px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .category-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 6px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .category-tab:hover {
            border-color: #fff;
            color: #fff;
        }

        .category-tab.active {
            background: #fff;
            border-color: #fff;
            color: #000;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 16px;
        }  

        /* Left Clicker Module Styles */
        .leftclicker-card {
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            display: none;
        }

        .leftclicker-card.leftclicker-visible {
            display: block;
        }

        .leftclicker-card:hover {
            border-color: #fff;
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.05);
        }

        .leftclicker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .leftclicker-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.05em;
        }

        .leftclicker-icon {
            width: 32px;
            height: 32px;
            background: #1a1a1a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        .leftclicker-toggle {
            position: relative;
            width: 48px;
            height: 26px;
            background: #1a1a1a;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #2a2a2a;
        }

        .leftclicker-toggle.leftclicker-active {
            background: #fff;
            border-color: #fff;
        }

        .leftclicker-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .leftclicker-toggle.leftclicker-active .leftclicker-toggle-slider {
            transform: translateX(22px);
            background: #000;
        }

        .leftclicker-settings {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #1a1a1a;
        }

        .leftclicker-settings.leftclicker-show {
            display: block;
        }

        .leftclicker-setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .leftclicker-setting-label {
            font-size: 0.9em;
            color: #ccc;
        }

        .leftclicker-setting-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: #fff;
            font-weight: 600;
        }

        .leftclicker-slider-container {
            width: 100%;
            margin-top: 8px;
        }

        .leftclicker-slider {
            width: 100%;
            height: 4px;
            background: #1a1a1a;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .leftclicker-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        .leftclicker-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .leftclicker-expand-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .leftclicker-expand-btn:hover {
            color: #fff;
        }

        .leftclicker-expand-btn i {
            transition: transform 0.3s ease;
        }

        .leftclicker-expand-btn.leftclicker-expanded i {
            transform: rotate(180deg);
        }

        .leftclicker-keybind-input {
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            color: #fff;
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .leftclicker-keybind-input:hover {
            border-color: #fff;
        }

        .leftclicker-keybind-input.leftclicker-recording {
            border-color: #0f0;
            animation: leftclicker-pulse 1s infinite;
        }

        @keyframes leftclicker-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .leftclicker-checkbox {
            width: 20px;
            height: 20px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .leftclicker-checkbox i {
            display: none;
        }

        .leftclicker-checkbox.leftclicker-checked {
            background: #fff;
            border-color: #fff;
        }

        .leftclicker-checkbox.leftclicker-checked i {
            color: #000;
            display: block;
        }

        /* Macro Module Styles */
        .macro-card {
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            display: none;
        }

        .macro-card.macro-visible {
            display: block;
        }

        .macro-card:hover {
            border-color: #fff;
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.05);
        }

        .macro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .macro-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.05em;
        }

        .macro-icon {
            width: 32px;
            height: 32px;
            background: #1a1a1a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        .macro-toggle {
            position: relative;
            width: 48px;
            height: 26px;
            background: #1a1a1a;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #2a2a2a;
        }

        .macro-toggle.macro-active {
            background: #fff;
            border-color: #fff;
        }

        .macro-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .macro-toggle.macro-active .macro-toggle-slider {
            transform: translateX(22px);
            background: #000;
        }

        .macro-settings {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #1a1a1a;
        }

        .macro-settings.macro-show {
            display: block;
        }

        .macro-setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .macro-setting-label {
            font-size: 0.9em;
            color: #ccc;
        }

        .macro-setting-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: #fff;
            font-weight: 600;
        }

        .macro-expand-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .macro-expand-btn:hover {
            color: #fff;
        }

        .macro-expand-btn i {
            transition: transform 0.3s ease;
        }

        .macro-expand-btn.macro-expanded i {
            transform: rotate(180deg);
        }

        .macro-keybind-input {
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            color: #fff;
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .macro-keybind-input:hover {
            border-color: #fff;
        }

        /* Overlay Module Styles */
        .overlay-card {
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            display: none;
        }

        .overlay-card.overlay-visible {
            display: block;
        }

        .overlay-card:hover {
            border-color: #fff;
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.05);
        }

        .overlay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .overlay-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 1.05em;
        }

        .overlay-icon {
            width: 32px;
            height: 32px;
            background: #1a1a1a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        .overlay-toggle {
            position: relative;
            width: 48px;
            height: 26px;
            background: #1a1a1a;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #2a2a2a;
        }

        .overlay-toggle.overlay-active {
            background: #fff;
            border-color: #fff;
        }

        .overlay-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #666;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .overlay-toggle.overlay-active .overlay-toggle-slider {
            transform: translateX(22px);
            background: #000;
        }

        .overlay-settings {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #1a1a1a;
        }

        .overlay-settings.overlay-show {
            display: block;
        }

        .overlay-setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .overlay-setting-label {
            font-size: 0.9em;
            color: #ccc;
        }

        .overlay-setting-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: #fff;
            font-weight: 600;
        }

        .overlay-slider-container {
            width: 100%;
            margin-top: 8px;
        }

        .overlay-slider {
            width: 100%;
            height: 4px;
            background: #1a1a1a;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .overlay-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        .overlay-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .overlay-expand-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .overlay-expand-btn:hover {
            color: #fff;
        }

        .overlay-expand-btn i {
            transition: transform 0.3s ease;
        }

        .overlay-expand-btn.overlay-expanded i {
            transform: rotate(180deg);
        }

        .overlay-color-picker {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            border: 2px solid #2a2a2a;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .overlay-color-picker:hover {
            border-color: #fff;
        }

        .overlay-checkbox {
            width: 20px;
            height: 20px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .overlay-checkbox i {
            display: none;
        }

        .overlay-checkbox.overlay-checked {
            background: #fff;
            border-color: #fff;
        }

        .overlay-checkbox.overlay-checked i {
            color: #000;
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .license-required-message {
            text-align: center;
            padding: 80px 20px;
            color: #666;
        }

        .license-required-message i {
            font-size: 3em;
            margin-bottom: 16px;
            color: #ffffff;
        }

        .license-required-message h3 {
            font-size: 1.5em;
            margin-bottom: 12px;
            color: #fff;
        }

        .license-required-message p {
            margin-bottom: 24px;
        }

        .license-required-message .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #fff;
            border: none;
            border-radius: 6px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            text-decoration: none;
        }

        .license-required-message .btn:hover {
            background: #f0f0f0;
        }

        /* ==================== COMPACT SETTINGS STYLES ==================== */
        
        .settings-container {
            max-width: 1200px;
        }

        /* Settings Tabs */
        .settings-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid #1a1a1a;
            padding-bottom: 0;
        }

        .settings-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-weight: 500;
            margin-bottom: -2px;
        }

        .settings-tab:hover {
            color: #fff;
            background: #0d0d0d;
        }

        .settings-tab.active {
            color: #fff;
            border-bottom-color: #fff;
            background: transparent;
        }

        .settings-tab i {
            font-size: 1.1em;
        }

        /* Settings Tab Content */
        .settings-tab-content {
            display: none;
        }

        .settings-tab-content.active {
            display: block;
        }

        /* Settings Grid - 2 columns */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
        }

        /* Settings Card */
        .settings-card {
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .settings-card:hover {
            border-color: #2a2a2a;
        }

        .settings-card-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }

        .settings-card-title i {
            color: #666;
            font-size: 1em;
        }

        /* Danger Card */
        .danger-card {
            border-color: rgba(255, 68, 68, 0.3);
        }

        .danger-card:hover {
            border-color: rgba(255, 68, 68, 0.5);
        }

        /* Form Groups - More Compact */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85em;
            color: #999;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            color: #fff;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #fff;
            background: #111;
        }

        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            background: #fff;
            border: none;
            border-radius: 6px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-family: 'Inter', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        /* Info Box - More Compact */
        .info-box {
            background: #222222;
            border: 1px solid #222222;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .info-box:last-child {
            margin-bottom: 0;
        }

        .info-box.warning {
            border-color: #474747;
            background: rgba(255, 136, 0, 0.05);
        }

        .info-box.success {
            border-color: #222222;
            background: #222222;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a2a;
        }

        .info-row:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .info-row:first-child {
            padding-top: 0;
        }

        .info-label {
            color: #666;
            font-size: 0.85em;
        }

        .info-value {
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
            color: #fff;
            font-weight: 500;
        }

        /* Messages - More Compact */
        .success-message,
        .error-message {
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            display: none;
            font-size: 0.85em;
            align-items: center;
            gap: 8px;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #00ff00;
            color: #00ff00;
        }

        .error-message {
            background: rgba(255, 68, 68, 0.05);
            border: 1px solid #ff4444;
            color: #ff4444;
        }

        .success-message.show,
        .error-message.show {
            display: flex;
        }

        /* License Badge */
        .license-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
        }

        .license-badge.lifetime {
            background: #ffffff;
            color: #000000;
        }

        .license-badge.month {
            background: #ffffff;
            color: #000000;
        }

        .license-badge.week {
            background: #ffffff;
            color: #000000;
        }

        .license-badge.expired {
            background: #ffffff;
            color: #000000;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .settings-tabs {
                flex-direction: column;
                border-bottom: none;
            }
            
            .settings-tab {
                border-bottom: 1px solid #1a1a1a;
                border-left: 2px solid transparent;
                margin-bottom: 0;
                margin-left: -2px;
            }
            
            .settings-tab.active {
                border-left-color: #fff;
                border-bottom-color: #1a1a1a;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                    <span>asce.</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item active" data-section="modules" data-requires-license="true" onclick="switchSection(event, 'modules')">
                    <i class="fas fa-th-large"></i>
                    <span>Modules</span>
                </div>
                <div class="nav-item" data-section="settings" onclick="switchSection(event, 'settings')">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="nav-item" data-section="download" data-requires-license="true" onclick="switchSection(event, 'download')">
                    <i class="fas fa-download"></i>
                    <span>Download</span>
                </div>
                <div class="nav-item" data-section="changelog" onclick="switchSection(event, 'changelog')">
                    <i class="fas fa-list"></i>
                    <span>Changelog</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="connection-status">
                    <div class="status-dot" id="connectionDot"></div>
                    <span id="connectionText">not connected</span>
                </div>

                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>

                <div class="user-profile" onclick="switchSection(event, 'settings')">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-license" id="userLicense"></div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: #666; font-size: 0.8em;"></i>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="top-bar">
                <div class="page-title">
                    <i id="pageTitleIcon" class="fas fa-th-large"></i>
                    <span id="pageTitle">Modules</span>
                </div>

                <div class="search-bar" id="searchBar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search modules..." onkeyup="filterModules()">
                </div>
            </div>

            <div class="content-area">
                <div id="modules-section" class="content-section active">
                    <div id="modulesContent">
                        <div class="category-tabs">
                            <div class="category-tab active" data-category="combat" onclick="filterCategory(event, 'combat')">COMBAT</div>
                            <div class="category-tab" data-category="visual" onclick="filterCategory(event, 'visual')">VISUAL</div>
                            <div class="category-tab" data-category="utilities" onclick="filterCategory(event, 'utilities')">UTILITIES</div>
                        </div>

                        <div class="module-grid" id="moduleGrid">
                            <!-- Left Clicker -->
                            <div class="leftclicker-card leftclicker-visible" data-category="combat" data-module="leftclicker" data-name="left clicker">
                                <div class="leftclicker-header">
                                    <div class="leftclicker-title">
                                        <div class="leftclicker-icon"><i class="fas fa-mouse-pointer"></i></div>
                                        <span>Left Clicker</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <button class="leftclicker-expand-btn" onclick="toggleLeftClickerSettings()">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="leftclicker-toggle" data-setting="enabled" onclick="toggleLeftClicker()">
                                            <div class="leftclicker-toggle-slider"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="leftclicker-settings" id="module-leftclicker-settings">
                                    <div class="leftclicker-setting-row">
                                        <span class="leftclicker-setting-label">CPS</span>
                                        <span class="leftclicker-setting-value" id="leftclickerCpsValue">10.0</span>
                                    </div>
                                    <div class="leftclicker-slider-container">
                                        <input type="range" class="leftclicker-slider" min="1" max="25" step="0.1" value="10" oninput="updateLeftClickerCps(this.value)" id="leftclickerCpsSlider">
                                    </div>
                                    <div class="leftclicker-setting-row" style="margin-top: 16px;">
                                        <span class="leftclicker-setting-label">Hotkey</span>
                                        <input type="text" class="leftclicker-keybind-input" value="F6" readonly onclick="recordLeftClickerKeybind(this)" id="leftclickerHotkeyInput">
                                    </div>
                                    <div class="leftclicker-setting-row" style="margin-top: 16px;">
                                        <span class="leftclicker-setting-label">Hold to Click</span>
                                        <div class="leftclicker-checkbox" data-setting="holdToClick" onclick="toggleLeftClickerHoldToClick()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="leftclicker-setting-row">
                                        <span class="leftclicker-setting-label">Blatant Mode</span>
                                        <div class="leftclicker-checkbox" data-setting="blatantMode" onclick="toggleLeftClickerBlatantMode()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="leftclicker-setting-row">
                                        <span class="leftclicker-setting-label">Exhaust Mode</span>
                                        <div class="leftclicker-checkbox" data-setting="exhaustMode" onclick="toggleLeftClickerExhaustMode()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Macro -->
                            <div class="macro-card" data-category="utilities" data-module="macro" data-name="macro">
                                <div class="macro-header">
                                    <div class="macro-title">
                                        <div class="macro-icon"><i class="fas fa-code"></i></div>
                                        <span>Macro</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <button class="macro-expand-btn" onclick="toggleMacroSettings()">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="macro-toggle" data-setting="useMacro" onclick="toggleMacro()">
                                            <div class="macro-toggle-slider"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="macro-settings" id="module-macro-settings">
                                    <div class="macro-setting-row">
                                        <span class="macro-setting-label">Loaded Intervals</span>
                                        <span class="macro-setting-value" id="macroIntervalCount">0</span>
                                    </div>
                                    <div style="margin-top: 16px;">
                                        <button class="macro-keybind-input" onclick="openMacroEditor()">
                                            <i class="fas fa-edit"></i> Edit Macro
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Overlay -->
                            <div class="overlay-card" data-category="visual" data-module="overlay" data-name="overlay">
                                <div class="overlay-header">
                                    <div class="overlay-title">
                                        <div class="overlay-icon"><i class="fas fa-eye"></i></div>
                                        <span>Overlay</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <button class="overlay-expand-btn" onclick="toggleOverlaySettings()">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="overlay-toggle" data-setting="overlayEnabled" onclick="toggleOverlay()">
                                            <div class="overlay-toggle-slider"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="overlay-settings" id="module-overlay-settings">
                                    <div class="overlay-setting-row">
                                        <span class="overlay-setting-label">Scale</span>
                                        <span class="overlay-setting-value" id="overlayScaleValue">100%</span>
                                    </div>
                                    <div class="overlay-slider-container">
                                        <input type="range" class="overlay-slider" min="50" max="200" step="10" value="100" oninput="updateOverlayScale(this.value)" id="overlayScaleSlider">
                                    </div>
                                    <div class="overlay-setting-row" style="margin-top: 16px;">
                                        <span class="overlay-setting-label">Text Color</span>
                                        <input type="color" class="overlay-color-picker" value="#ffffff" onchange="updateOverlayTextColor(this.value)" id="overlayColorPicker">
                                    </div>
                                    <div class="overlay-setting-row">
                                        <span class="overlay-setting-label">Background</span>
                                        <div class="overlay-checkbox" data-setting="overlayBackground" onclick="toggleOverlayBackground()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="overlay-setting-row">
                                        <span class="overlay-setting-label">Lowercase</span>
                                        <div class="overlay-checkbox" data-setting="overlayLowercase" onclick="toggleOverlayLowercase()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="overlay-setting-row">
                                        <span class="overlay-setting-label">Shadow</span>
                                        <div class="overlay-checkbox" data-setting="overlayShadow" onclick="toggleOverlayShadow()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="overlay-setting-row">
                                        <span class="overlay-setting-label">Rainbow</span>
                                        <div class="overlay-checkbox" data-setting="overlayRainbow" onclick="toggleOverlayRainbow()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                    <div class="overlay-setting-row">
                                        <span class="overlay-setting-label">Watermark</span>
                                        <div class="overlay-checkbox" data-setting="overlayWatermark" onclick="toggleOverlayWatermark()">
                                            <i class="fas fa-check"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="noLicenseMessage" class="license-required-message" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>License Required</h3>
                        <p>You need an active license to access modules.</p>
                        <a href="#" class="btn" onclick="switchSection(event, 'settings'); return false;">
                            <i class="fas fa-key"></i> Activate License
                        </a>
                    </div>
                </div>

                <!-- ==================== COMPACT SETTINGS SECTION ==================== -->
                <div id="settings-section" class="content-section">
                    <div class="settings-container">
                        <!-- Settings Tabs -->
                        <div class="settings-tabs">
                            <div class="settings-tab active" onclick="switchSettingsTab('account')">
                                <i class="fas fa-user"></i>
                                <span>Account</span>
                            </div>
                            <div class="settings-tab" onclick="switchSettingsTab('license')">
                                <i class="fas fa-certificate"></i>
                                <span>License</span>
                            </div>
                            <div class="settings-tab" onclick="switchSettingsTab('security')">
                                <i class="fas fa-lock"></i>
                                <span>Security</span>
                            </div>
                        </div>

                        <!-- Account Tab -->
                        <div id="account-tab" class="settings-tab-content active">
                            <div class="settings-grid">
                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-info-circle"></i>
                                        Account Information
                                    </div>
                                    <div class="info-box">
                                        <div class="info-row">
                                            <span class="info-label">Username</span>
                                            <span class="info-value" id="settingsUsername">-</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Email</span>
                                            <span class="info-value" id="settingsEmail">-</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Role</span>
                                            <span class="info-value" id="settingsRole">-</span>
                                        </div>
                                        <div class="info-row">
                                            <span class="info-label">Total Clicks</span>
                                            <span class="info-value" id="settingsClicks">-</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-envelope"></i>
                                        Change Email
                                    </div>
                                    <div class="success-message" id="emailSuccess">
                                        <i class="fas fa-check-circle"></i> Email updated!
                                    </div>
                                    <div class="error-message" id="emailError">
                                        <i class="fas fa-exclamation-circle"></i> <span id="emailErrorText"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New Email Address</label>
                                        <input type="email" class="form-input" id="newEmailInput" placeholder="your@email.com">
                                    </div>
                                    <button class="btn btn-full" onclick="changeEmail()">
                                        <i class="fas fa-save"></i> Update Email
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- License Tab -->
                        <div id="license-tab" class="settings-tab-content">
                            <div class="settings-grid">
                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-certificate"></i>
                                        Current License
                                    </div>
                                    <div class="info-box" id="licenseInfoBox">
                                        <div class="info-row">
                                            <span class="info-label">Type</span>
                                            <span class="info-value">
                                                <span class="license-badge" id="licenseBadge">Free</span>
                                            </span>
                                        </div>
                                        <div class="info-row" id="licenseExpiryRow" style="display: none;">
                                            <span class="info-label">Expires In</span>
                                            <span class="info-value" id="licenseExpiry">-</span>
                                        </div>
                                        <div class="info-row" id="licenseStatusRow" style="display: none;">
                                            <span class="info-label">Status</span>
                                            <span class="info-value" id="licenseStatus">Active</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-card" id="activationSection">
                                    <div class="settings-card-title">
                                        <i class="fas fa-key"></i>
                                        Activate License
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">License Key</label>
                                        <input type="text" class="form-input" id="licenseKeyInput" placeholder="XXXXX-XXXXX-XXXXX-XXXXX">
                                    </div>
                                    <button class="btn btn-full" onclick="activateLicense()">
                                        <i class="fas fa-check"></i> Activate Now
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Security Tab -->
                        <div id="security-tab" class="settings-tab-content">
                            <div class="settings-grid">
                                <div class="settings-card">
                                    <div class="settings-card-title">
                                        <i class="fas fa-lock"></i>
                                        Change Password
                                    </div>
                                    <div class="success-message" id="passwordSuccess">
                                        <i class="fas fa-check-circle"></i> Password updated!
                                    </div>
                                    <div class="error-message" id="passwordError">
                                        <i class="fas fa-exclamation-circle"></i> <span id="passwordErrorText"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Current Password</label>
                                        <input type="password" class="form-input" id="currentPasswordInput" placeholder="">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New Password</label>
                                        <input type="password" class="form-input" id="newPasswordInput" placeholder="">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-input" id="confirmPasswordInput" placeholder="">
                                    </div>
                                    <button class="btn btn-full" onclick="changePassword()">
                                        <i class="fas fa-save"></i> Update Password
                                    </button>
                                </div>

                                
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ==================== END COMPACT SETTINGS SECTION ==================== -->

                <div id="download-section" class="content-section">
                    <div id="downloadContent">
                        <div class="empty-state">
                            <i class="fas fa-download"></i>
                            <p>Download client coming soon</p>
                        </div>
                    </div>
                    
                    <div id="noLicenseMessageDownload" class="license-required-message" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>License Required</h3>
                        <p>You need an active license to download the client.</p>
                        <a href="#" class="btn" onclick="switchSection(event, 'settings'); return false;">
                            <i class="fas fa-key"></i> Activate License
                        </a>
                    </div>
                </div>

                <div id="changelog-section" class="content-section">
                    <div class="empty-state">
                        <i class="fas fa-list"></i>
                        <p>Changelog coming soon</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>

        let lastSavedConfig = {};
        let saveTimeout = null;

        const API_URL = 'https://asce-8vqj.onrender.com';
        let currentConfig = {};
        let currentUser = {};
        let ws = null;
        let isUpdatingFromServer = false;
        let hasActiveLicense = false;

        async function init() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'auth.html';
                return;
            }

            try {
                await loadUserProfile();
                await loadSettings();
                connectWebSocket(token);
            } catch (error) {}
        }

        async function loadUserProfile() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_URL}/user/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    currentUser = await response.json();
                    updateUserDisplay();
                    checkLicenseStatus();
                }
            } catch (error) {}
        }

        function checkLicenseStatus() {
            if (currentUser.license && currentUser.license.status === 'active') {
                hasActiveLicense = true;
            } else {
                hasActiveLicense = false;
            }
            updateLicenseRestrictions();
        }

        function updateLicenseRestrictions() {
            const navItems = document.querySelectorAll('.nav-item[data-requires-license="true"]');
            navItems.forEach(item => {
                if (hasActiveLicense) {
                    item.classList.remove('locked');
                } else {
                    item.classList.add('locked');
                }
            });

            const modulesContent = document.getElementById('modulesContent');
            const noLicenseMessage = document.getElementById('noLicenseMessage');
            if (modulesContent && noLicenseMessage) {
                if (hasActiveLicense) {
                    modulesContent.style.display = 'block';
                    noLicenseMessage.style.display = 'none';
                } else {
                    modulesContent.style.display = 'none';
                    noLicenseMessage.style.display = 'block';
                }
            }

            const downloadContent = document.getElementById('downloadContent');
            const noLicenseMessageDownload = document.getElementById('noLicenseMessageDownload');
            if (downloadContent && noLicenseMessageDownload) {
                if (hasActiveLicense) {
                    downloadContent.style.display = 'block';
                    noLicenseMessageDownload.style.display = 'none';
                } else {
                    downloadContent.style.display = 'none';
                    noLicenseMessageDownload.style.display = 'block';
                }
            }
        }

        function updateUserDisplay() {
            const userNameEl = document.getElementById('userName');
            const userAvatarEl = document.getElementById('userAvatar');
            const userLicenseEl = document.getElementById('userLicense');
            
            if (userNameEl) userNameEl.textContent = currentUser.username || 'User';
            if (userAvatarEl) userAvatarEl.textContent = (currentUser.username || 'U').charAt(0).toUpperCase();
            
            if (userLicenseEl) {
                if (currentUser.license) {
                    const timeRemaining = currentUser.license.timeRemaining || 'Lifetime';
                    userLicenseEl.textContent = `${currentUser.license.type}  ${timeRemaining}`;
                    userLicenseEl.classList.add('premium');
                } else {
                    userLicenseEl.textContent = 'No License';
                    userLicenseEl.classList.remove('premium');
                }
            }

            const settingsUsername = document.getElementById('settingsUsername');
            const settingsEmail = document.getElementById('settingsEmail');
            const settingsRole = document.getElementById('settingsRole');
            const settingsClicks = document.getElementById('settingsClicks');

            if (settingsUsername) settingsUsername.textContent = currentUser.username;
            if (settingsEmail) settingsEmail.textContent = currentUser.email;
            if (settingsRole) settingsRole.textContent = currentUser.role;
            if (settingsClicks) settingsClicks.textContent = (currentUser.totalClicks || 0).toLocaleString();

            updateLicenseDisplay();
        }

        function updateLicenseDisplay() {
            const licenseBadge = document.getElementById('licenseBadge');
            const licenseExpiry = document.getElementById('licenseExpiry');
            const licenseStatus = document.getElementById('licenseStatus');
            const licenseExpiryRow = document.getElementById('licenseExpiryRow');
            const licenseStatusRow = document.getElementById('licenseStatusRow');
            const activationSection = document.getElementById('activationSection');
            const licenseInfoBox = document.getElementById('licenseInfoBox');

            if (currentUser.license) {
                const license = currentUser.license;
                if (licenseBadge) {
                    licenseBadge.textContent = license.type.charAt(0).toUpperCase() + license.type.slice(1);
                    licenseBadge.className = 'license-badge ' + license.type;
                }
                if (licenseExpiryRow) licenseExpiryRow.style.display = 'flex';
                if (licenseExpiry) licenseExpiry.textContent = license.timeRemaining;
                if (licenseStatusRow) licenseStatusRow.style.display = 'flex';
                if (licenseStatus) licenseStatus.textContent = license.status.charAt(0).toUpperCase() + license.status.slice(1);
                if (activationSection) activationSection.style.display = 'none';
                if (licenseInfoBox) licenseInfoBox.className = 'info-box success';
            } else {
                if (licenseBadge) {
                    licenseBadge.textContent = 'No License';
                    licenseBadge.className = 'license-badge expired';
                }
                if (licenseExpiryRow) licenseExpiryRow.style.display = 'none';
                if (licenseStatusRow) licenseStatusRow.style.display = 'none';
                if (activationSection) activationSection.style.display = 'block';
                if (licenseInfoBox) licenseInfoBox.className = 'info-box warning';
            }
        }

        async function activateLicense() {
            const token = localStorage.getItem('token');
            const licenseKeyInput = document.getElementById('licenseKeyInput');
            if (!licenseKeyInput || !licenseKeyInput.value.trim()) {
                alert('Please enter a license key');
                return;
            }
            try {
                const response = await fetch(`${API_URL}/auth/activate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ licenseKey: licenseKeyInput.value.trim() })
                });
                const data = await response.json();
                if (response.ok) {
                    alert('License activated successfully!');
                    licenseKeyInput.value = '';
                    await loadUserProfile();
                } else {
                    alert(data.error || 'Failed to activate license');
                }
            } catch (error) {
                alert('Failed to activate license');
            }
        }

        async function changeEmail() {
            const token = localStorage.getItem('token');
            const newEmailInput = document.getElementById('newEmailInput');
            const emailSuccess = document.getElementById('emailSuccess');
            const emailError = document.getElementById('emailError');
            const emailErrorText = document.getElementById('emailErrorText');
            if (emailSuccess) emailSuccess.classList.remove('show');
            if (emailError) emailError.classList.remove('show');
            if (!newEmailInput || !newEmailInput.value.trim()) {
                if (emailErrorText) emailErrorText.textContent = 'Please enter a new email';
                if (emailError) emailError.classList.add('show');
                return;
            }
            try {
                const response = await fetch(`${API_URL}/user/profile`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email: newEmailInput.value.trim() })
                });
                const data = await response.json();
                if (response.ok) {
                    if (emailSuccess) emailSuccess.classList.add('show');
                    newEmailInput.value = '';
                    await loadUserProfile();
                } else {
                    if (emailErrorText) emailErrorText.textContent = data.error || 'Failed to update email';
                    if (emailError) emailError.classList.add('show');
                }
            } catch (error) {
                if (emailErrorText) emailErrorText.textContent = 'Failed to update email';
                if (emailError) emailError.classList.add('show');
            }
        }

        async function changePassword() {
            const token = localStorage.getItem('token');
            const currentPasswordInput = document.getElementById('currentPasswordInput');
            const newPasswordInput = document.getElementById('newPasswordInput');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const passwordSuccess = document.getElementById('passwordSuccess');
            const passwordError = document.getElementById('passwordError');
            const passwordErrorText = document.getElementById('passwordErrorText');
            if (passwordSuccess) passwordSuccess.classList.remove('show');
            if (passwordError) passwordError.classList.remove('show');
            if (!currentPasswordInput || !currentPasswordInput.value) {
                if (passwordErrorText) passwordErrorText.textContent = 'Please enter your current password';
                if (passwordError) passwordError.classList.add('show');
                return;
            }
            if (!newPasswordInput || !newPasswordInput.value) {
                if (passwordErrorText) passwordErrorText.textContent = 'Please enter a new password';
                if (passwordError) passwordError.classList.add('show');
                return;
            }
            if (newPasswordInput.value !== confirmPasswordInput.value) {
                if (passwordErrorText) passwordErrorText.textContent = 'Passwords do not match';
                if (passwordError) passwordError.classList.add('show');
                return;
            }
            try {
                const response = await fetch(`${API_URL}/user/profile`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        currentPassword: currentPasswordInput.value,
                        newPassword: newPasswordInput.value
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    if (passwordSuccess) passwordSuccess.classList.add('show');
                    currentPasswordInput.value = '';
                    newPasswordInput.value = '';
                    confirmPasswordInput.value = '';
                } else {
                    if (passwordErrorText) passwordErrorText.textContent = data.error || 'Failed to update password';
                    if (passwordError) passwordError.classList.add('show');
                }
            } catch (error) {
                if (passwordErrorText) passwordErrorText.textContent = 'Failed to update password';
                if (passwordError) passwordError.classList.add('show');
            }
        }

        async function loadSettings() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_URL}/agent/settings`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (response.ok) {
                    currentConfig = await response.json();
                    isUpdatingFromServer = true;
                    applySettings(currentConfig);
                    isUpdatingFromServer = false;
                }
            } catch (error) {}
        }

        function applySettings(config) {
            try {
                const leftClickerToggle = document.querySelector('.leftclicker-toggle[data-setting="enabled"]');
                if (leftClickerToggle) {
                    if (config.enabled) {
                        leftClickerToggle.classList.add('leftclicker-active');
                    } else {
                        leftClickerToggle.classList.remove('leftclicker-active');
                    }
                    lastSavedConfig = { ...config };
                }

                const leftclickerCpsValue = document.getElementById('leftclickerCpsValue');
                const leftclickerCpsSlider = document.getElementById('leftclickerCpsSlider');
                if (leftclickerCpsValue) leftclickerCpsValue.textContent = (config.cps || 10).toFixed(1);
                if (leftclickerCpsSlider) leftclickerCpsSlider.value = config.cps || 10;

                const holdToClickCheck = document.querySelector('.leftclicker-checkbox[data-setting="holdToClick"]');
                if (holdToClickCheck) {
                    if (config.holdToClick) {
                        holdToClickCheck.classList.add('leftclicker-checked');
                    } else {
                        holdToClickCheck.classList.remove('leftclicker-checked');
                    }
                }

                const blatantModeCheck = document.querySelector('.leftclicker-checkbox[data-setting="blatantMode"]');
                if (blatantModeCheck) {
                    if (config.blatantMode) {
                        blatantModeCheck.classList.add('leftclicker-checked');
                    } else {
                        blatantModeCheck.classList.remove('leftclicker-checked');
                    }
                }

                const exhaustModeCheck = document.querySelector('.leftclicker-checkbox[data-setting="exhaustMode"]');
                if (exhaustModeCheck) {
                    if (config.exhaustMode) {
                        exhaustModeCheck.classList.add('leftclicker-checked');
                    } else {
                        exhaustModeCheck.classList.remove('leftclicker-checked');
                    }
                }

                const macroToggle = document.querySelector('.macro-toggle[data-setting="useMacro"]');
                if (macroToggle) {
                    if (config.useMacro) {
                        macroToggle.classList.add('macro-active');
                    } else {
                        macroToggle.classList.remove('macro-active');
                    }
                }

                const macroIntervalCount = document.getElementById('macroIntervalCount');
                if (macroIntervalCount) {
                    macroIntervalCount.textContent = config.macroIntervals ? config.macroIntervals.length : 0;
                }

                const overlayToggle = document.querySelector('.overlay-toggle[data-setting="overlayEnabled"]');
                if (overlayToggle) {
                    if (config.overlayEnabled) {
                        overlayToggle.classList.add('overlay-active');
                    } else {
                        overlayToggle.classList.remove('overlay-active');
                    }
                }

                const overlayScaleValue = document.getElementById('overlayScaleValue');
                const overlayScaleSlider = document.getElementById('overlayScaleSlider');
                if (overlayScaleValue) overlayScaleValue.textContent = (config.overlayScale || 100) + '%';
                if (overlayScaleSlider) overlayScaleSlider.value = config.overlayScale || 100;

                const overlayBackgroundCheck = document.querySelector('.overlay-checkbox[data-setting="overlayBackground"]');
                if (overlayBackgroundCheck) {
                    if (config.overlayBackground) {
                        overlayBackgroundCheck.classList.add('overlay-checked');
                    } else {
                        overlayBackgroundCheck.classList.remove('overlay-checked');
                    }
                }

                const overlayLowercaseCheck = document.querySelector('.overlay-checkbox[data-setting="overlayLowercase"]');
                if (overlayLowercaseCheck) {
                    if (config.overlayLowercase) {
                        overlayLowercaseCheck.classList.add('overlay-checked');
                    } else {
                        overlayLowercaseCheck.classList.remove('overlay-checked');
                    }
                }

                const overlayShadowCheck = document.querySelector('.overlay-checkbox[data-setting="overlayShadow"]');
                if (overlayShadowCheck) {
                    if (config.overlayShadow) {
                        overlayShadowCheck.classList.add('overlay-checked');
                    } else {
                        overlayShadowCheck.classList.remove('overlay-checked');
                    }
                }

                const overlayRainbowCheck = document.querySelector('.overlay-checkbox[data-setting="overlayRainbow"]');
                if (overlayRainbowCheck) {
                    if (config.overlayRainbow) {
                        overlayRainbowCheck.classList.add('overlay-checked');
                    } else {
                        overlayRainbowCheck.classList.remove('overlay-checked');
                    }
                }

                const overlayWatermarkCheck = document.querySelector('.overlay-checkbox[data-setting="overlayWatermark"]');
                if (overlayWatermarkCheck) {
                    if (config.overlayWatermark) {
                        overlayWatermarkCheck.classList.add('overlay-checked');
                    } else {
                        overlayWatermarkCheck.classList.remove('overlay-checked');
                    }
                }

                if (config.overlayTextColorR !== undefined) {
                    const colorPicker = document.getElementById('overlayColorPicker');
                    if (colorPicker) {
                        const r = config.overlayTextColorR || 255;
                        const g = config.overlayTextColorG || 255;
                        const b = config.overlayTextColorB || 255;
                        const hex = '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
                        colorPicker.value = hex;
                    }
                }
            } catch (error) {}
        }

        async function saveSettings(updates) {
            const token = localStorage.getItem('token');
            currentConfig = { ...currentConfig, ...updates };

            let hasRealChanges = false;
            for (const key in updates) {
                if (lastSavedConfig[key] !== updates[key]) {
                    hasRealChanges = true;
                    break;
                }
            }

            if (!hasRealChanges) {
                return;
            }

            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`${API_URL}/agent/settings`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(currentConfig)
                    });

                    if (response.ok) {
                        lastSavedConfig = { ...currentConfig };
                    }
                } catch (error) {}
            }, 500);
        }

        function toggleLeftClickerSettings() {
            const settings = document.getElementById('module-leftclicker-settings');
            const btn = document.querySelector('.leftclicker-expand-btn');
            if (settings && btn) {
                const isOpen = settings.classList.contains('leftclicker-show');
                if (isOpen) {
                    btn.classList.remove('leftclicker-expanded');
                    settings.classList.remove('leftclicker-show');
                } else {
                    btn.classList.add('leftclicker-expanded');
                    settings.classList.add('leftclicker-show');
                }
            }
        }

        function toggleLeftClicker() {
            if (isUpdatingFromServer) return;
            const toggle = document.querySelector('.leftclicker-toggle[data-setting="enabled"]');
            if (!toggle) return;
            toggle.classList.toggle('leftclicker-active');
            const isActive = toggle.classList.contains('leftclicker-active');
            saveSettings({ enabled: isActive });
        }

        function updateLeftClickerCps(value) {
            if (isUpdatingFromServer) return;
            const valueEl = document.getElementById('leftclickerCpsValue');
            if (valueEl) valueEl.textContent = parseFloat(value).toFixed(1);
            saveSettings({ cps: parseFloat(value) });
        }

        function recordLeftClickerKeybind(input) {
            if (!input) return;
            input.classList.add('leftclicker-recording');
            input.value = 'Press any key...';
            const handler = (e) => {
                e.preventDefault();
                input.value = e.key.toUpperCase();
                input.classList.remove('leftclicker-recording');
                saveSettings({ hotkeyCode: e.keyCode });
                document.removeEventListener('keydown', handler);
            };
            document.addEventListener('keydown', handler);
        }

        function toggleLeftClickerHoldToClick() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.leftclicker-checkbox[data-setting="holdToClick"]');
            if (!checkbox) return;
            checkbox.classList.toggle('leftclicker-checked');
            const isChecked = checkbox.classList.contains('leftclicker-checked');
            saveSettings({ holdToClick: isChecked });
        }

        function toggleLeftClickerBlatantMode() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.leftclicker-checkbox[data-setting="blatantMode"]');
            if (!checkbox) return;
            checkbox.classList.toggle('leftclicker-checked');
            const isChecked = checkbox.classList.contains('leftclicker-checked');
            saveSettings({ blatantMode: isChecked });
        }

        function toggleLeftClickerExhaustMode() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.leftclicker-checkbox[data-setting="exhaustMode"]');
            if (!checkbox) return;
            checkbox.classList.toggle('leftclicker-checked');
            const isChecked = checkbox.classList.contains('leftclicker-checked');
            saveSettings({ exhaustMode: isChecked });
        }

        function toggleMacroSettings() {
            const settings = document.getElementById('module-macro-settings');
            const btn = document.querySelector('.macro-expand-btn');
            if (settings && btn) {
                const isOpen = settings.classList.contains('macro-show');
                if (isOpen) {
                    btn.classList.remove('macro-expanded');
                    settings.classList.remove('macro-show');
                } else {
                    btn.classList.add('macro-expanded');
                    settings.classList.add('macro-show');
                }
            }
        }

        function toggleMacro() {
            if (isUpdatingFromServer) return;
            const toggle = document.querySelector('.macro-toggle[data-setting="useMacro"]');
            if (!toggle) return;
            toggle.classList.toggle('macro-active');
            const isActive = toggle.classList.contains('macro-active');
            saveSettings({ useMacro: isActive });
        }

        function toggleOverlaySettings() {
            const settings = document.getElementById('module-overlay-settings');
            const btn = document.querySelector('.overlay-expand-btn');
            if (settings && btn) {
                const isOpen = settings.classList.contains('overlay-show');
                if (isOpen) {
                    btn.classList.remove('overlay-expanded');
                    settings.classList.remove('overlay-show');
                } else {
                    btn.classList.add('overlay-expanded');
                    settings.classList.add('overlay-show');
                }
            }
        }

        function toggleOverlay() {
            if (isUpdatingFromServer) return;
            const toggle = document.querySelector('.overlay-toggle[data-setting="overlayEnabled"]');
            if (!toggle) return;
            toggle.classList.toggle('overlay-active');
            const isActive = toggle.classList.contains('overlay-active');
            saveSettings({ overlayEnabled: isActive });
        }

        function updateOverlayScale(value) {
            if (isUpdatingFromServer) return;
            const valueEl = document.getElementById('overlayScaleValue');
            if (valueEl) valueEl.textContent = value + '%';
            saveSettings({ overlayScale: parseFloat(value) });
        }

        function updateOverlayTextColor(color) {
            if (isUpdatingFromServer) return;
            const r = parseInt(color.substr(1, 2), 16);
            const g = parseInt(color.substr(3, 2), 16);
            const b = parseInt(color.substr(5, 2), 16);
            saveSettings({
                overlayTextColorR: r,
                overlayTextColorG: g,
                overlayTextColorB: b
            });
        }

        function toggleOverlayBackground() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.overlay-checkbox[data-setting="overlayBackground"]');
            if (!checkbox) return;
            checkbox.classList.toggle('overlay-checked');
            const isChecked = checkbox.classList.contains('overlay-checked');
            saveSettings({ overlayBackground: isChecked });
        }

        function toggleOverlayLowercase() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.overlay-checkbox[data-setting="overlayLowercase"]');
            if (!checkbox) return;
            checkbox.classList.toggle('overlay-checked');
            const isChecked = checkbox.classList.contains('overlay-checked');
            saveSettings({ overlayLowercase: isChecked });
        }

        function toggleOverlayShadow() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.overlay-checkbox[data-setting="overlayShadow"]');
            if (!checkbox) return;
            checkbox.classList.toggle('overlay-checked');
            const isChecked = checkbox.classList.contains('overlay-checked');
            saveSettings({ overlayShadow: isChecked });
        }

        function toggleOverlayRainbow() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.overlay-checkbox[data-setting="overlayRainbow"]');
            if (!checkbox) return;
            checkbox.classList.toggle('overlay-checked');
            const isChecked = checkbox.classList.contains('overlay-checked');
            saveSettings({ overlayRainbow: isChecked });
        }

        function toggleOverlayWatermark() {
            if (isUpdatingFromServer) return;
            const checkbox = document.querySelector('.overlay-checkbox[data-setting="overlayWatermark"]');
            if (!checkbox) return;
            checkbox.classList.toggle('overlay-checked');
            const isChecked = checkbox.classList.contains('overlay-checked');
            saveSettings({ overlayWatermark: isChecked });
        }

        function filterCategory(event, category) {
            if (!event) return;
            document.querySelectorAll('.category-tab').forEach(tab => {
                if (tab) tab.classList.remove('active');
            });
            if (event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            const leftClickerCards = document.querySelectorAll('.leftclicker-card');
            const macroCards = document.querySelectorAll('.macro-card');
            const overlayCards = document.querySelectorAll('.overlay-card');
            
            leftClickerCards.forEach(card => {
                if (!card) return;
                if (card.dataset.category === category) {
                    card.classList.add('leftclicker-visible');
                } else {
                    card.classList.remove('leftclicker-visible');
                }
            });
            
            macroCards.forEach(card => {
                if (!card) return;
                if (card.dataset.category === category) {
                    card.classList.add('macro-visible');
                } else {
                    card.classList.remove('macro-visible');
                }
            });
            
            overlayCards.forEach(card => {
                if (!card) return;
                if (card.dataset.category === category) {
                    card.classList.add('overlay-visible');
                } else {
                    card.classList.remove('overlay-visible');
                }
            });
        }

        function filterModules() {
            const searchInput = document.getElementById('searchInput');
            if (!searchInput) return;
            const search = searchInput.value.toLowerCase();
            
            const leftClickerCards = document.querySelectorAll('.leftclicker-card');
            const macroCards = document.querySelectorAll('.macro-card');
            const overlayCards = document.querySelectorAll('.overlay-card');
            
            leftClickerCards.forEach(card => {
                if (!card) return;
                const name = card.dataset.name || '';
                card.style.display = name.includes(search) ? 'block' : 'none';
            });
            
            macroCards.forEach(card => {
                if (!card) return;
                const name = card.dataset.name || '';
                card.style.display = name.includes(search) ? 'block' : 'none';
            });
            
            overlayCards.forEach(card => {
                if (!card) return;
                const name = card.dataset.name || '';
                card.style.display = name.includes(search) ? 'block' : 'none';
            });
        }

        function switchSection(event, section) {
            if (!event) return;
            event.preventDefault();
            
            const navItem = event.currentTarget;
            if (navItem && navItem.classList.contains('locked')) {
                alert('This section requires an active license. Please activate a license in Settings.');
                section = 'settings';
            }
            
            document.querySelectorAll('.nav-item').forEach(nav => {
                if (nav) nav.classList.remove('active');
            });
            
            const targetNav = document.querySelector(`.nav-item[data-section="${section}"]`);
            if (targetNav) {
                targetNav.classList.add('active');
            }
            
            document.querySelectorAll('.content-section').forEach(s => {
                if (s) s.classList.remove('active');
            });
            const sectionEl = document.getElementById(section + '-section');
            if (sectionEl) {
                sectionEl.classList.add('active');
            }
            const titles = {
                'modules': { text: 'Modules', icon: 'fa-th-large' },
                'settings': { text: 'Settings', icon: 'fa-cog' },
                'download': { text: 'Download', icon: 'fa-download' },
                'changelog': { text: 'Changelog', icon: 'fa-list' }
            };
            if (titles[section]) {
                const pageTitle = document.getElementById('pageTitle');
                const pageTitleIcon = document.getElementById('pageTitleIcon');
                if (pageTitle) pageTitle.textContent = titles[section].text;
                if (pageTitleIcon) pageTitleIcon.className = 'fas ' + titles[section].icon;
            }
            const searchBar = document.getElementById('searchBar');
            if (searchBar) {
                searchBar.style.display = section === 'modules' ? 'block' : 'none';
            }
        }

        // NEW: Settings Tab Switching Function
        function switchSettingsTab(tabName) {
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.settings-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            
            const tabContent = document.getElementById(`${tabName}-tab`);
            if (tabContent) {
                tabContent.classList.add('active');
            }
        }

        function connectWebSocket(token) {
            const dot = document.getElementById('connectionDot');
            const text = document.getElementById('connectionText');
            if (dot) dot.classList.remove('connected');
            if (text) text.textContent = 'not connected';
            
            try {
                ws = new WebSocket(`ws://localhost:3000?token=${token}`);
                ws.onopen = () => {
                    const dot = document.getElementById('connectionDot');
                    const text = document.getElementById('connectionText');
                    if (dot) dot.classList.add('connected');
                    if (text) text.textContent = 'connected';
                };
                ws.onclose = () => {
                    const dot = document.getElementById('connectionDot');
                    const text = document.getElementById('connectionText');
                    if (dot) dot.classList.remove('connected');
                    if (text) text.textContent = 'not connected';
                    setTimeout(() => connectWebSocket(token), 3000);
                };
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        if (data.type === 'settings_update') {
                            isUpdatingFromServer = true;
                            applySettings(data.settings);
                            isUpdatingFromServer = false;
                        }
                    } catch (error) {}
                };
                ws.onerror = (error) => {};
            } catch (error) {}
        }

        async function logout() {
            if (!confirm('Are you sure you want to logout?')) {
                return;
            }
            const token = localStorage.getItem('token');
            try {
                await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
            } catch (error) {}
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'auth.html';
        }

        function openMacroEditor() {
            alert('Macro editor coming soon!');
        }

        window.addEventListener('load', init);
    </script>
</body>

</html>

